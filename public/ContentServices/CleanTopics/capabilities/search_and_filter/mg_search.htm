<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head />
    <body>Upgrading from Version 7.* to Version 8.* With this version of the Search module we have migrated toElasticsearch 5.6. Please read the Elasticsearch Breaking Changes in 5.0 official documentation to adjust your custom implementation accordingly. Your development environment needs to be updated with Elasticsearch 5.6.x. In case you are using the Spryker DevVM, you can download the latest release that provides the necessary services. Follow our Installation Guide for detailed instructions about installing the Spryker DevVM. Elasticsearch 5 Related BC Breaking Change Highlights stringfields replaced bytext/keywordfield: mapping changed for all string fields in the indexes. indexproperty: theindexproperty now only acceptstrue/falseinstead ofnot_analyzed/no. size: 0on Terms, Significant Terms and Geohash Grid Aggregations: the Demoshop used this feature to aggregate infinite number of categories. Size should be set to a fixed number instead. missingquery was removed, use a negated exists query instead. Other BC Breaking Changes Previously thevendor/bin/console setup:searchcommand installed indexes for all stores. Now it only installs the index for the current store. Upgrading from Version 6.* to Version 7.* Zed changes: With version 7 we have fixed a bug with incorrect mapping of a filter name with request parameters. If you have modified/extended\Spryker\Client\Search\Model\Elasticsearch\AggregationExtractor\CategoryExtractor,\Spryker\Client\Search\Model\Elasticsearch\AggregationExtractor\FacetExtractor,\Spryker\Client\Search\Model\Elasticsearch\AggregationExtractor\RangeExtractoryou have to merge the latest changes with the core. Especially this is important forextractDataFromAggregationsmethod.\Spryker\Client\Search\Plugin\Config\FacetConfigBuildernow looks for facet from the request parameters.\Spryker\Client\Search\Plugin\Config\SortConfigBuildernow looks for configuration by configuration field name. Yves changes: The UrlGenerator was incorrectly setting the request parameters, therefore now it is necessary to changeprocessFacetSearchResultTransferandprocessRangeSearchResultTransferas shown in the code sample below. Click here to expand the code sample namespace Pyz\Yves\Catalog\ActiveSearchFilter; class UrlGenerator implements UrlGeneratorInterface
{ /** * @param array $params * @param \Generated\Shared\Transfer\FacetSearchResultTransfer $searchResultTransfer * @param string|null $filterValue * * @return array */ protected function processFacetSearchResultTransfer(array $params, FacetSearchResultTransfer $searchResultTransfer, $filterValue = null) { $param = $params[$searchResultTransfer-&gt;getName()]; if (is_array($param) &amp;&amp; $filterValue !== null) { $index = array_search($filterValue, $param); unset($params[$searchResultTransfer-&gt;getName()][$index]); return $params; } unset($params[$searchResultTransfer-&gt;getName()]); return $params; } /** * @param array $params * @param \Generated\Shared\Transfer\RangeSearchResultTransfer $searchResultTransfer * * @return array */ protected function processRangeSearchResultTransfer(array $params, RangeSearchResultTransfer $searchResultTransfer) { unset($params[$searchResultTransfer-&gt;getName()]); return $params; } You have to change the way filters are configured in twig templates. Previously there was an incorrect setting on using a name, instead of a request parameter. The filters are under"Pyz/Yves/Catalog/Theme/default/catalog/partials/filters"directory. Twig templates also require changes: "multi-select.twig": &lt;input type="checkbox" name="{{ filter.name }}[]" ...should be&lt;input type="checkbox" name="{{ filter.config.parameterName }}[]" ... "price-range.twig": &lt;input type="number" name="{{ filter.name }}[min]" ... ... &lt;input type="number" name="{{ filter.name }}[max]"should be&lt;input type="number" name="{{ filter.config.parameterName }}[min]" ... ... &lt;input type="number" name="{{ filter.config.parameterName }}[max]" ... "range.twig": &lt;input type="number" name="{{ filter.name }}[min]" ... ... &lt;input type="number" name="{{ filter.name }}[max]" ...should be&lt;input type="number" name="{{ filter.config.parameterName }}[min]" ... ... &lt;input type="number" name="{{ filter.config.parameterName }}[max]" ... "rating.twig" &lt;input type="hidden" name="{{ filter.name }}[min]" ...should be&lt;input type="hidden" name="{{ filter.config.parameterName }}[min]" ... "single-select.twig" &lt;input type="radio" name="{{ filter.name }}" ...should be&lt;input type="radio" name="{{ filter.config.parameterName }}" ... "Pyz/Yves/Catalog/Theme/default/catalog/partials/filters.twig": {{ ('product.filter.' ~ filter.name) | trans }}should be{{ ('product.filter.' ~ filter.name | lower) | trans }} Upgrading from Version 4.* to Version 5.* We changed the way dynamic search configuration was cached and then used. This feature caused the following non-backward compatible changes: TheSpryker\Shared\Search\SearchConstants::SEARCH_CONFIG_CACHE_KEYconfig was removed, but previously it was required to be filled with a key that was used to save the search config cache into Redis. RemovedSearchFacade::saveSearchConfigCache()method which stored the given search cache configuration into Redis. In the new version, instead of the removed code mentioned above, you’ll need to provide a list ofSpryker\Client\Search\Dependency\Plugin\SearchConfigExpanderPluginInterfaceinPyz\Client\Search\SearchDependencyProvider::createSearchConfigExpanderPlugins()instead. We moved the possible facet type option constants fromSpryker\Client\Search\Plugin\Config\FacetConfigBuilderto\Spryker\Shared\Search\SearchConstants: FacetConfigBuilder::TYPE_ENUMERATION-&gt;SearchConstants::FACET_TYPE_ENUMERATION FacetConfigBuilder::TYPE_RANGE-&gt;SearchConstants::FACET_TYPE_RANGE FacetConfigBuilder::TYPE_PRICE_RANGE-&gt;SearchConstants::FACET_TYPE_PRICE_RANGE FacetConfigBuilder::TYPE_CATEGORY-&gt;SearchConstants::FACET_TYPE_CATEGORY FacetConfigBuilder::TYPE_BOOL-&gt;not supported We have added a type field to the default “page” index type defined bySearch/src/Spryker/Shared/Search/IndexMap/search.json. With this field it’s possible to differentiate multiple item types (e.g. products, cms pages, categories, etc.). Additionally, we also fixed the indexing strategy of store andlocalefield, they are set to “not_analyzed”. These changes require a repeated indexation of your existing data. In a non-production environment this means that you need to delete your index and then install the new one by runningvendor/bin/console setup:search. In production environments, follow the official Elasticsearch guide about Index Aliases and Zero Downtime . Upgrading from version 3.* to Version 4.* With the version 4 of the Search(Undefined variable: General.bundle/module), the logic and configuration of how the results are sorted has been changed. Previously there were two request parameters that controlled what field we are sorting by as well as the direction of the sorting (e.g /?sort=price&amp;sort_order=desc). The new version now works with one parameter only (e.g. /?sort=price_asc). To migrate to the new version, you’ll need to change your configurations in your classes that implement\Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface. Instead of providing oneSortConfigTransferper sorted attribute, now you need to provide two if you wish to sort by both ascending and descending order. To do this, use theSortConfigTransfer::setIsDescending()method, and make sure that the values inSortConfigTransfer::setParameterName()are unique. Please check the Search documentation for a detailed example . See also: Learn more about Search module Last review date: Mar. 9th, 2018</body>
</html>