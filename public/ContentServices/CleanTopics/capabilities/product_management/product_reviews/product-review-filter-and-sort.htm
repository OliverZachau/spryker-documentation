<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head />
    <body>Prerequisites Configure your product collector query which provides theproduct datafor your product page map and add the requiredaverage ratingvalue. Amend product page map to make it possible to filter and sort by rating value. Normalize the rating value if it is necessary for your Search engine. If you open an abstract product in your Search engine, you will see the additional sort and facet information with the normalized rating. Example of product review data in product abstract record in Elasticsearch: { "_index": "de_search", "_type": "page", "_id": "de.de_de.resource.product_abstract.35", "_score": 1, "_source": { "search-result-data": { "rating": 4.67, "review_count": 3 }, "integer-sort": { "rating": 467 }, "integer-facet": [ { "facet-name": "rating", "facet-value": [ 467 ] } ] } } Adding Average Rating Sort Option Amend yourCatalogSearchConfigBuilderand register the average rating sort. Example: sort registration &lt;?php namespace Pyz\Client\Catalog\Plugin\Config; use Generated\Shared\Search\PageIndexMap; use Generated\Shared\Transfer\SortConfigTransfer; use Spryker\Client\Kernel\AbstractPlugin; use Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface; use Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface; class CatalogSearchConfigBuilder extends AbstractPlugin implements SearchConfigBuilderInterface { const RATING_FACET_NAME = 'rating'; /** * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder * * @return void */ public function buildSortConfig(SortConfigBuilderInterface $sortConfigBuilder) { $this-&gt;addDescendingRatingSort($sortConfigBuilder); // ... } /** * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder * * @return $this */ protected function addDescendingRatingSort(SortConfigBuilderInterface $sortConfigBuilder) { $descendingRatingSortConfig = (new SortConfigTransfer()) -&gt;setName(static::RATING_FACET_NAME) -&gt;setParameterName(static::RATING_FACET_NAME) -&gt;setFieldName(PageIndexMap::INTEGER_SORT) -&gt;setIsDescending(true); $sortConfigBuilder-&gt;addSort($descendingRatingSortConfig); return $this; } } Adding Average Rating Range Filter Amend yourCatalogSearchConfigBuilderand register the average rating range filter facet. Example: range filter facet registration &lt;?php namespace Pyz\Client\Catalog\Plugin\Config; use Generated\Shared\Transfer\FacetConfigTransfer; use Spryker\Client\Kernel\AbstractPlugin; use Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface; use Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface; class CatalogSearchConfigBuilder extends AbstractPlugin implements SearchConfigBuilderInterface { const RATING_FACET_NAME = 'rating'; /** * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder * * @return void */ public function buildFacetConfig(FacetConfigBuilderInterface $facetConfigBuilder) { $this-&gt;addProductRatingFacet($facetConfigBuilder); // ... } /** * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder * * @return $this */ protected function addProductRatingFacet(FacetConfigBuilderInterface $facetConfigBuilder) { $productRatingFacetTransfer = (new FacetConfigTransfer()) -&gt;setName(static::RATING_FACET_NAME) -&gt;setParameterName(static::RATING_FACET_NAME) -&gt;setFieldName(PageIndexMap::INTEGER_FACET) -&gt;setType(SearchConfig::FACET_TYPE_RANGE); $facetConfigBuilder-&gt;addFacet($productRatingFacetTransfer); return $this; } } Float Filtering With Search If your search engine supports only integer filtering, you will need to transform the filter value between display and usage. Example: use-case Assumptions Your Search engine is only able to store integer values, such as-1, 0, 1, 2, 3, [...]. Your current Product Reviews configuration allows to have float average ratings, such as0.53, 2.41, 4.9, 5 [...]. Average rating is limited up to 2 decimals. Complication In this case, you need to temporarily transform the average rating to integer to fit the Search engine's requirements and you also want to keep the original float value so you can display it for the end-users. Solution You can solve this by multiplying/dividing your average rating with 10 to the power of the number of allowed decimals. transform displayed value into stored value:2.41 * 10^2 =&gt; 241. transform stored value into displayed value:241 / 10^2 =&gt; 2.41. Create aTransformerthat implementsFacetSearchResultValueTransformerPluginInterfaceand define the transformation and its inverse. Then register this transformer for the already configured rating range filter. Example: average rating range filter value transformer namespace Pyz\Client\ProductReview\Plugin; use Spryker\Client\Search\Dependency\Plugin\FacetSearchResultValueTransformerPluginInterface; class ProductRatingValueTransformer implements FacetSearchResultValueTransformerPluginInterface { /** * @param array $rangeValues * * @return array */ public function transformForDisplay($rangeValues) { if (isset($rangeValues['min'])) { $rangeValues['min'] = $this-&gt;normalizeRatingForDisplay($rangeValues['min']); } if (isset($rangeValues['max'])) { $rangeValues['max'] = $this-&gt;normalizeRatingForDisplay($rangeValues['max']); } return $rangeValues; } /** * @param array $rangeValues * * @return array */ public function transformFromDisplay($rangeValues) { if (isset($rangeValues['min'])) { $rangeValues['min'] = $this-&gt;normalizeRatingForFilter($rangeValues['min']); } if (isset($rangeValues['max'])) { $rangeValues['max'] = $this-&gt;normalizeRatingForFilter($rangeValues['max']); } return $rangeValues; } /** * @param int $filteredRating * * @return int */ protected function normalizeRatingForDisplay($filteredRating) { return (int)round($filteredRating / 100); } /** * @param int $displayedRating * * @return int */ protected function normalizeRatingForFilter($displayedRating) { return $displayedRating * 100; } } Example: range filter value transfer registration &lt;?php /** * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder * * @return $this */ protected function addProductRatingFacet(FacetConfigBuilderInterface $facetConfigBuilder) { $productRatingFacetTransfer = (new FacetConfigTransfer()) -&gt;setName(static::RATING_FACET_NAME) -&gt;setParameterName(static::RATING_FACET_NAME) -&gt;setFieldName(PageIndexMap::INTEGER_FACET) -&gt;setType(SearchConfig::FACET_TYPE_RANGE) -&gt;setValueTransformer(ProductRatingValueTransformer::class); $facetConfigBuilder-&gt;addFacet($productRatingFacetTransfer); return $this; } Last review date: Aug. 28, 2017</body>
</html>