<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head />
    <body>Spryker Commerce OS uses the Calculation module to calculate the cart totals that are displayed in the cart/checkout or when the order is placed.
It's also used to recalculate the order totals after refund. The calculation module extensively uses plugins to inject calculation algorithms. How Calculation Works Quote Transfer The quote transfer object is used to store data and plugins that calculate the amounts. There is already a list of plugins which populate quote transfer with corresponding data. Calculations are executed every time the content of the cart is updated. For more details see Cart Data Flow . If manual cart recalculation is required,CalculationFacade::recalculatecan be called from Zed orCalculationClient::recalculatefrom Yves with prepared Quote Transfer . When the recalculation operation is called, the calculator runs the calculator plugin stack and each plugin modifies the QuoteTransfer (calculates discounts, adds sum gross prices, calculates taxes, etc.). Most plugins require theunitPriceand thequantityto be provided. Calculated amounts Each amount is calculated and stored in cents. Its important to understand how the Calculator works internally with theCalculableObjectTransfergeneric data structure. This data structure allows us to work with different object types e.g.OrderTransferandQuoteTransfer. Therefor, before passing a Quote object to the calculators, the object is then converted to a calculable object. After calculation, the original object that was passed is converted back to the object's recalculated state. Each calculable object holds reference to theCalculableObjectTransfer::originalQuoteandCalculableObjectTransfer::originalOrder objects, in order for you to use this for more context when working with a custom calculator. Do not modifyCalculableObjectTransfer::originalQuoteandCalculableObjectTransfer::originalOrderas changes will not be propagated. Download our Calculation Spreadsheet to see how calculations are made. Price Mode You can switch price mode calculators using by settingQuoteTransfer::priceModeproperty, this will change tax calculation and values forunitPriceandsumPrice will be read fromunitNetPriceandsumNetPricerespectively. This value is set in cart ExpanderCartItemPricePlugin. Price mode is also persisted when order is placed.</body>
</html>