<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head />
    <body>Calculator plugins are registered in theCalculationDependencyProvider::getQuoteCalculatorPluginStack()forQuoteTransferandCalculationDependencyProvider::getOrderCalculatorPluginStack()or in later versions of the Calculation module 4.00 and aboveCalculationDependencyProvider::getQuoteCalculatorPluginStack()forOrderTransfer. This method can be extended on the project level and the plugin stack can be updated with your own plugins. Each calculator must implementCalculatorPluginInterface. For more information see: &lt;?php
interface CalculationPluginInterface
{ /** * @api * * @param \Generated\Shared\Transfer\CalculableObjectTransfer $calculableObjectTransfer * * @return void */ public function recalculate(CalculableObjectTransfer $calculableObjectTransfer);
} RemoveTotalsCalculatorPlugin- Resets quote totals, sets TotalsTransfer empty. RemoveAllCalculatedDiscountsCalculatorPlugin- Resets every CalculatedDiscountTransfer. ItemGrossAmountsCalculatorPlugin- CalculatessumGrossPricefor each ItemTransfer. ItemTransfer::sumGrossPrice = ItemTransfer::unitGrossPrice * ItemTransfer::quantity ProductOptionGrossSumCalculatorPlugin-Calculates unitGrossPriceWithProductOptions,sumGrossPriceWithProductOptionsfor ItemTransfer andsumGrossPricefor ProductOptionTransfer. ProductOptionTransfer::sumGrossPrice = ProductOptionTransfer::unitGrossPrice * ProductOptionTransfer::quantity
ItemTransfer::unitGrossPriceWithProductOptions = sum(ProductOptionTransfer::unitGrossPrice) + ItemTransfer::unitGrossPrice
ItemTransfer::sumGrossPriceWithProductOptions = sum(ProductOptionTransfer::sumGrossPrice) + ItemTransfer:sumGrossPrice SubtotalTotalsCalculatorPlugin- Sums each of thesumGrossPriceWithProductOptionsitems. TotalsTransfer::subtotal = sum(ItemTransfer::sumGrossPriceWithProductOptions) ExpensesGrossSumAmountCalculatorPlugin- CalculatessumGrossPricefor each item. ExpenseTransfer::sumGrossPrice = ExpenseTransfer::unitGrossPrice * ExpenseTransfer::quantity ExpenseTotalsCalculatorPlugin- CalculatesexpenseTotalin TotalsTransfer. TotalsTransfer::expenseTotal = sum(ExpenseTransfer::sumGrossPrice) DiscountCalculatorPlugin- Applies discounts to current QuoteTransfer each discountable item with propertycalculatedDiscounts, gets discounts filled. AlsovoucherDiscountsandcartRuleDiscountsare populated with additional used discount data for order level. Discount Calculation Discount calculation is a separate topic and is explained here Discount . SumGrossCalculatedDiscountAmountCalculatorPlugin- Calculates and setsItemTransferamounts after discounts tosumGrossPriceWithProductOptionAndDiscountAmountsandunitGrossPriceWithProductOptionAndDiscountAmounts;sets expense amounts after discounts tounitGrossPriceWithDiscountsandsumGrossPriceWithDiscounts. ItemTransfer::unitGrossPriceWithProductOptionAndDiscountAmounts = ItemTransfer::unitGrossPriceWithProductOptions - (sum(ItemTransfer:calculatedDiscounts::unitGrossPrice) + sum(ProductOptionTransfer::calculatedDiscounts::unitGrossPrice))
ItemTransfer::sumGrossPriceWithProductOptionAndDiscountAmounts = ItemTransfer::sumGrossPriceWithProductOptions - (sum(ItemTransfer:calculatedDiscounts::sumGrossPrice) + sum(ProductOptionTransfer::calculatedDiscounts::sumGrossPrice)) DiscountTotalsCalculatorPlugin- Calculates total for discounts used and sets it tototalDiscountinTotalsTransfer. Sum all discountable itemCalculatedDiscountTransfergross amounts: TotalsTransfer:discountTotal += sum(ItemTransfer::CalculateDiscountTransfer::sumGrossAmount +
ItemTransfer::ProductOptionTransfer::CalculateDiscountTransfer::sumGrossAmount + ExpenseTransfer::sumGrossAmount)
GrandTotalTotalsCalculatorPlugin - Calculates grandTotal in TotalsTransfer.
TotalsTransfer:grandTotal = TotalsTransfer::subtotal + TotalsTransfer:expenseTotal GrandTotalWithDiscountsCalculatorPlugin- CalculatesGrandTotalafter discounts inTotalsTransfer. TotalsTransfer:grandTotal = TotalsTransfer::subtotal + TotalsTransfer:expenseTotal - TotalsTransfer::discountTotal TaxTotalsCalculatorPlugin- CalculatestaxTotalandtaxRateused from TotalTransfer::grandTotal, sets it inTotalsTransfer::TaxTotalsTransfer. TaxableItems = ItemTransfer, ProductOptionTransfer, ExpenseTransfer. TaxTotalsTransfer::taxRate = sum(TaxableItems) / TaxableItems TaxTotalsTransfer::taxAmount = round((TotalsTransfer::grandTotal * TaxTotalsTransfer::taxRate) / TaxTotalsTransfer::taxRate / 100)</body>
</html>