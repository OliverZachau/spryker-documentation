<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head />
    <body>The latest version of this module can be found here Sales Getting Totals for Order Spryker does not store order grand total or subtotal amounts; all amounts are stored before calculation, order items store single item gross amounts, discounts store single item discount amount. To get the discount total there is a facade methodSalesFacade::getOrderTotalsByIdSalesOrder()for order level which will returnOrderTransferwith aggregated grandTotal, subtotals, expenses, discounts and another is item levelSalesFacade:getOrderItemTotalsByIdSalesOrderItem()which returnsItemTransfersingle item amounts. Order Aggregator As there are no totals stored, those amounts should be retrieved (aggregated) from different places of the system. Like discount module, product option module, sales module etc. This aggregation is provided by specialized plugins. Each plugin has to implemented.OrderTotalsAggregatePluginInterfaceand work withOrderTransferdata object. Plugins are registered in the Sales module’sSalesDependencyProvider::getItemAmountAggregationPlugins()andSalesDependencyProvider::getOrderAmountAggregationPlugins()method. There is already list of plugins implemented. Expense total aggregator plugin (order level) Aggregates expense total amount; reads data from sales_expense and stores it intoTotalsTransfer:expenseTotal. Order expenses with discounts aggregator plugin (order level) Aggregates expense amounts after discounts and stores it intoExpenseTransfer:unitGrossPriceWithDiscountsandExpenseTransfer:sumGrossPriceWithDiscounts. Order expense tax amount aggregator plugin (order level) Aggregates tax amount and store intoExpenseTransfer::unitTaxAmountandExpenseTransfer::sumTaxAmount. Order expense tax with discounts aggregator plugin (order level) Aggregates tax amount after discounts and stores it intoExpenseTransfer::unitTaxAmountWithDiscountsandExpenseTransfer::sumTaxAmountWithDiscounts. Item gross price aggregator plugin (item level) Aggregates item gross price amount intoItemTransfer::unitGrossPriceandItemTransfer::sumGrossPrice. Product options gross price aggregator plugin (item level) Aggregates item gross price with product options intoItemTransfer::unitGrossPriceWithProductOptions,ItemTransfer::sumGrossPriceWithProductOptionsand setItemTransfer::refundableAmounts. Subtotal order aggregator plugin (order level) Aggregates subtotal by adding allItemTransfer::sumGrossPrice. Subtotal with product options aggregator plugin (order level) Aggregates subtotal by adding allItemTransfer::sumGrossPriceWithProductOptions. Item discounts order aggregator plugin (item level) Aggregates discounts from sales_discount table; stores them intounitGrossPriceWithDiscounts,sumGrossPriceWithDiscountsfor all discountable items. Product option discounts aggregator plugin (item level) Aggregates discounts for items with product options from sales_discount table intoItemTransfer::unitGrossPriceWithProductOptionAndDiscountAmounts,ItemTransfer::sumGrossPriceWithProductOptionAndDiscountAmounts,ItemTransfer:refundableAmount. Discount total amount aggregator plugin (order level) Aggregates total discount amount used for current order; stores it inTotalTransfer:discountTotal. Discount total amount with product options aggregator plugin (order level) Aggregates total discount amount with product option discounts and stores it intoTotalTransfer:discountTotal. Order discount aggregator plugin (order level) Aggregates all discounts used in current order and stores it intoOrderTransfer::calculatedDiscounts. Order discounts with product options aggregator plugin (order level) Aggregates all discounts with product options used in current order and stores it intoOrderTransfer::calculatedDiscounts. Grand total aggregator plugin (order level) Aggregates order grandTotal by calculatingTotalTransfer::grandTotal = TotalTransfer::subTotal + TotalTransfer::expenseTotal Order grand total with discounts aggregator plugin (order level) Aggregates order grandTotal by calculatingTotalTransfer::grandTotal = TotalTransfer::subTotal + TotalTransfer::expenseTotal - TotalsTransfer:discountTotal Item tax amount aggregator plugin (item level) Calculates tax rate for each and stores it intoItemTransfer::unitTaxAmount,ItemTransfer::sumTaxAmount. Item tax with discounts aggregator plugin (item level) Calculates tax rate for items with product optionsItemTransfer::unitTaxAmountWithDiscounts,ItemTransfer::sumTaxAmountWithDiscounts. Items with product options and discounts tax aggregator plugin (item level) Calculates tax rate for items with product options and after discounts and stores it intoItemTransfer::unitTaxAmountWithProductOptionAndDiscountAmounts,ItemTransfer::sumTaxAmountWithProductOptionAndDiscountAmounts. Order tax amount with product options and discounts aggregator plugin (order level) Stores tax rate and tax amount from grandTotal intoTaxTotalTransfer::taxRate,TaxTotalTransfer::amount.</body>
</html>