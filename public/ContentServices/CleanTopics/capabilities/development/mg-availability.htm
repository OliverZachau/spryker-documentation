<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head />
    <body>Upgrading from Version 5.* to Version 6.* In Availability module version 6 we have added support for multi-store. Administrtion Interface has undergone some changes to allow selecting stores and update database tables to store relations to store. To upgrade, first you need to run database migrations: ALTER TABLE "spy_availability" ADD "fk_store" INTEGER; ALTER TABLE "spy_availability" ADD CONSTRAINT "spy_availability-fk_store" FOREIGN KEY ("fk_store") REFERENCES "spy_store" ("id_store"); ALTER TABLE "spy_availability_abstract" ADD "fk_store" INTEGER; ALTER TABLE "spy_availability_abstract" ADD CONSTRAINT "spy_availability_abstract-fk_store" FOREIGN KEY ("fk_store") REFERENCES "spy_store" ("id_store"); Then: Runvendor/bin/console propel:model:build- this will update models. Runvendor/bin/console transfer:generate- this will create new transfer objects. We have changed public API for methods in:\Spryker\Zed\Availability\Business\AvailabilityFacade::findProductAbstractAvailabilityreceived a third argument foridStore. We have also changed the way data is collected by collector, now it has to filter data by current store. Change:\Pyz\Zed\Collector\Business\Storage\AvailabilityCollector: $productConcreteAvailability = SpyAvailabilityQuery::create() -&gt;filterByFkStore($this-&gt;getCurrentStore()-&gt;getIdStore()) //note the new filter by method. -&gt;findByFkAvailabilityAbstract($idAvailabilityAbstract); Change:\Pyz\Zed\Collector\Persistence\Storage\Propel\AvailabilityCollectorQueryto collect only current store availability: $this-&gt;touchQuery-&gt;addJoin( [ SpyAvailabilityAbstractTableMap::COL_ABSTRACT_SKU, SpyAvailabilityAbstractTableMap::COL_FK_STORE, ], [ SpyProductAbstractTableMap::COL_SKU, $this-&gt;getStoreTransfer()-&gt;getIdStore(), ], Criteria::INNER_JOIN ); Upgrading from Version 3.* to Version 4.* AllAvailabilityUI has been moved toAvailabilitGuimodule, mostly Communication or Persistence were changed. If you have overwritten any of moved classes from those layers please change base class namespace fromAvailabilitytoAvailabilityGuiroot. Upgrading from Version 2.* to Version 3.* With Availability version 3 we have changed the way availability is calculated. Two new tables have been added: CREATE TABLE "spy_availability_abstract"
( "id_availability_abstract" INTEGER NOT NULL, "abstract_sku" VARCHAR(255) NOT NULL, "quantity" INTEGER DEFAULT 0 NOT NULL, PRIMARY KEY ("id_availability_abstract"), CONSTRAINT "spy_availability_abstract-sku" UNIQUE ("abstract_sku")
); CREATE SEQUENCE "spy_availability_pk_seq"; CREATE TABLE "spy_availability"
( "id_availability" INTEGER NOT NULL, "fk_availability_abstract" INTEGER NOT NULL, "sku" VARCHAR(255) NOT NULL, "quantity" INTEGER NOT NULL, "is_never_out_of_stock" BOOLEAN DEFAULT \'f\', PRIMARY KEY ("id_availability"), CONSTRAINT "spy_availability-sku" UNIQUE ("sku")
); ALTER TABLE "spy_availability" ADD CONSTRAINT "spy_availability-fk_spy_availability_abstract" FOREIGN KEY ("fk_availability_abstract") REFERENCES "spy_availability_abstract" ("id_availability_abstract");
', As this involves more than availability module, to start using it some configuration needed per module basis. Oms version &gt;= 4 is required. Check OMS migration to version 4 step by step guide how to migrate OMS to have new availability integrated. Cart &gt; 2.1 and AvailabilityCartConnector &gt; 2.0. To have cart availability pre check. You will need to add new pluginSpryker\Zed\AvailabilityCartConnector\Communication\Plugin\CheckAvailabilityPlugininto Cart project dependency provider.Pyz\Zed\Cart\CartDependencyProvider::getCartPreCheckPlugins()which is core implementation of cart availability check. New availability collector is required. Take it from demoshop,Pyz\Zed\Collector\Business\Storage\AvailabilityCollector, this have to be added toPyz\Zed\Collector\CollectorDependencyProviderstorage plugin stack. See also: Get a general idea about stock and availability Learn what Availability module does and how it works Last review date: Feb. 26th, 2018</body>
</html>