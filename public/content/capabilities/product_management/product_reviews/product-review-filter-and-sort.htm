<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Capabilities|Capabilities|Product Management|Product Reviews">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Filter &amp; Sort by Average Rating - Product Reviews</title>
        <link href="../../../../Skins/Default/Stylesheets/Elasticsearch.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.topic-ratings-button
{
	-pie-background: transparent url('../../../../Skins/Default/Stylesheets/Images/star-full.png') no-repeat center center;
}

.button.separator-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.edit-user-profile-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/edit-profile.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapSearch.Elastic.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search the Academy" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <script src="../../../resources/prism.js">
                                </script>
                                <div class="search-container">
                                    <form class="search" action="#">
                                        <div class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                            <input class="search-field needs-pie" type="search" placeholder="Search" />
                                            <div class="search-filter-wrapper">
                                                <div class="search-filter">
                                                    <div class="search-filter-content">
                                                        <ul>
                                                            <li>All Files</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="search-submit-wrapper" dir="ltr">
                                                <div class="search-submit" title="Search">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="nocontent">
                                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="XnGaf4KpakutSBLsjQ9XAw">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="XnGaf4KpakutSBLsjQ9XAw:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <div class="button-group star-buttons loading feedback-topic-required">
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                        </div>
                                                        <div class="button-separator feedback-topic-required">
                                                        </div>
                                                        <button class="button feedback-required login-button" id="normalLoginBtn" data-state1-class="login-button" data-state2-class="edit-user-profile-button" title="Login" data-state1-title="Login">
                                                            <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="login" />
                                                        </button>
                                                        <button class="button needs-pie print-button" title="Print">
                                                            <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                        </button>
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <h1>Filter &amp; Sort by Average Rating - Product Reviews</h1>
                                                <h2>Prerequisites</h2>
                                                <ol>
                                                    <li value="1">
                Configure your product collector query which provides the <var>product data</var> for your product page map and add the required <var>average rating</var> value.
            </li>
                                                    <li value="2">
                Amend product page map to make it possible to filter and sort by rating value. Normalize the rating value if it is necessary for your Search engine.
            </li>
                                                </ol>
                                                <p>If you open an abstract product in your Search engine, you will see the additional sort and facet information with the normalized rating.</p>
       
           Example of product review data in product abstract record in Elasticsearch:
           
           <pre><code class="json">
                 {
                    "_index": "de_search",
                    "_type": "page",
                    "_id": "de.de_de.resource.product_abstract.35",
                    "_score": 1,
                    "_source": {
                       "search-result-data": {
                          "rating": 4.67,
                          "review_count": 3
                       },
                       "integer-sort": {
                          "rating": 467
                       },
                       "integer-facet": [
                          {
                             "facet-name": "rating",
                             "facet-value": [
                                467
                             ]
                          }
                       ]
                    }
                 }
              </code></pre><h3>Adding Average Rating Sort Option</h3><p>Amend your <var>CatalogSearchConfigBuilder</var> and register the average rating sort.</p><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: sort registration</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">&lt;?php
    namespace Pyz\Client\Catalog\Plugin\Config;

    use Generated\Shared\Search\PageIndexMap;
    use Generated\Shared\Transfer\SortConfigTransfer;
    use Spryker\Client\Kernel\AbstractPlugin;
    use Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface;
    use Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface;

    class CatalogSearchConfigBuilder extends AbstractPlugin implements SearchConfigBuilderInterface
    {

        const RATING_FACET_NAME = 'rating';

        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder
         *
         * @return void
         */
        public function buildSortConfig(SortConfigBuilderInterface $sortConfigBuilder)
        {
            $this-&gt;addDescendingRatingSort($sortConfigBuilder);
            // ...
        }

        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\SortConfigBuilderInterface $sortConfigBuilder
         *
         * @return $this
         */
        protected function addDescendingRatingSort(SortConfigBuilderInterface $sortConfigBuilder)
        {
            $descendingRatingSortConfig = (new SortConfigTransfer())
                -&gt;setName(static::RATING_FACET_NAME)
                -&gt;setParameterName(static::RATING_FACET_NAME)
                -&gt;setFieldName(PageIndexMap::INTEGER_SORT)
                -&gt;setIsDescending(true);

            $sortConfigBuilder-&gt;addSort($descendingRatingSortConfig);

            return $this;
        }

    }
                </code></pre></div></div><a href="#" name="configure-rating-range-filter"></a><h3>Adding Average Rating Range Filter</h3><p>Amend your <var>CatalogSearchConfigBuilder</var> and register the average rating range filter facet.</p><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: range filter facet registration</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">&lt;?php
    namespace Pyz\Client\Catalog\Plugin\Config;

    use Generated\Shared\Transfer\FacetConfigTransfer;
    use Spryker\Client\Kernel\AbstractPlugin;
    use Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface;
    use Spryker\Client\Search\Dependency\Plugin\SearchConfigBuilderInterface;

    class CatalogSearchConfigBuilder extends AbstractPlugin implements SearchConfigBuilderInterface
    {
        const RATING_FACET_NAME = 'rating';

        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder
         *
         * @return void
         */
        public function buildFacetConfig(FacetConfigBuilderInterface $facetConfigBuilder)
        {
            $this-&gt;addProductRatingFacet($facetConfigBuilder);
            // ...
        }

        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder
         *
         * @return $this
         */
        protected function addProductRatingFacet(FacetConfigBuilderInterface $facetConfigBuilder)
        {
            $productRatingFacetTransfer = (new FacetConfigTransfer())
                -&gt;setName(static::RATING_FACET_NAME)
                -&gt;setParameterName(static::RATING_FACET_NAME)
                -&gt;setFieldName(PageIndexMap::INTEGER_FACET)
                -&gt;setType(SearchConfig::FACET_TYPE_RANGE);

            $facetConfigBuilder-&gt;addFacet($productRatingFacetTransfer);

            return $this;
        }

    }
                </code></pre></div></div><h3>Float Filtering With Search</h3><p>If your search engine supports only integer filtering, you will need to transform the filter value between display and usage.</p><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: use-case</a></span><div class="MCDropDownBody dropDownBody"><h4>Assumptions</h4><li value="2">Your Search engine is only able to store integer values, such as <var>-1, 0, 1, 2, 3, [...]</var>.</li><li value="3">Your current Product Reviews configuration allows to have float average ratings, such as <var>0.53, 2.41, 4.9, 5 [...]</var>.</li><li value="4">Average rating is limited up to 2 decimals.</li><h4>Complication</h4><p>In this case, you need to temporarily transform the average rating to integer to fit the Search engine's requirements and you also want to keep the original float value so you can display it for the end-users.</p><h4>Solution</h4><p>You can solve this by multiplying/dividing your average rating with 10 to the power of the number of allowed decimals.</p><li value="5">transform displayed value into stored value: <var>2.41 * 10^2 =&gt; 241</var>.</li><li value="6">transform stored value into displayed value: <var>241 / 10^2 =&gt; 2.41</var>.</li></div></div><p>Create a <var>Transformer</var> that implements <var>FacetSearchResultValueTransformerPluginInterface</var> and define the transformation and its inverse.</p><p>Then register this transformer for the already configured rating range filter.</p><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: average rating range filter value transformer</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">
    namespace Pyz\Client\ProductReview\Plugin;

    use Spryker\Client\Search\Dependency\Plugin\FacetSearchResultValueTransformerPluginInterface;

    class ProductRatingValueTransformer implements FacetSearchResultValueTransformerPluginInterface
    {

        /**
         * @param array $rangeValues
         *
         * @return array
         */
        public function transformForDisplay($rangeValues)
        {
            if (isset($rangeValues['min'])) {
                $rangeValues['min'] = $this-&gt;normalizeRatingForDisplay($rangeValues['min']);
            }

            if (isset($rangeValues['max'])) {
                $rangeValues['max'] = $this-&gt;normalizeRatingForDisplay($rangeValues['max']);
            }

            return $rangeValues;
        }

        /**
         * @param array $rangeValues
         *
         * @return array
         */
        public function transformFromDisplay($rangeValues)
        {
            if (isset($rangeValues['min'])) {
                $rangeValues['min'] = $this-&gt;normalizeRatingForFilter($rangeValues['min']);
            }

            if (isset($rangeValues['max'])) {
                $rangeValues['max'] = $this-&gt;normalizeRatingForFilter($rangeValues['max']);
            }

            return $rangeValues;
        }

        /**
         * @param int $filteredRating
         *
         * @return int
         */
        protected function normalizeRatingForDisplay($filteredRating)
        {
            return (int)round($filteredRating / 100);
        }

        /**
         * @param int $displayedRating
         *
         * @return int
         */
        protected function normalizeRatingForFilter($displayedRating)
        {
            return $displayedRating * 100;
        }

    }

                </code></pre></div></div><div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: range filter value transfer registration</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">&lt;?php
        /**
         * @param \Spryker\Client\Search\Dependency\Plugin\FacetConfigBuilderInterface $facetConfigBuilder
         *
         * @return $this
         */
        protected function addProductRatingFacet(FacetConfigBuilderInterface $facetConfigBuilder)
        {
            $productRatingFacetTransfer = (new FacetConfigTransfer())
                -&gt;setName(static::RATING_FACET_NAME)
                -&gt;setParameterName(static::RATING_FACET_NAME)
                -&gt;setFieldName(PageIndexMap::INTEGER_FACET)
                -&gt;setType(SearchConfig::FACET_TYPE_RANGE)
                -&gt;setValueTransformer(ProductRatingValueTransformer::class);

            $facetConfigBuilder-&gt;addFacet($productRatingFacetTransfer);

            return $this;
        }
                </code></pre></div></div><p>&#160;</p><p><![CDATA[
		]]><i>Last review date: Aug. 28, 2017 </i><![CDATA[		]]></p></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>