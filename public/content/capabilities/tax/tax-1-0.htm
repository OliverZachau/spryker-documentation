<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-conditions="Spryker.B2C,Spryker.B2B" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Tax Version 1.0  </title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.topic-ratings-button
{
	-pie-background: transparent url('../../../Skins/Default/Stylesheets/Images/star-full.png') no-repeat center center;
}

.button.separator-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.edit-user-profile-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/edit-profile.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search the Academy" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <script src="../../resources/prism.js">
                                </script>
                                <div class="search-container">
                                    <form class="search" action="#">
                                        <div class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                            <input class="search-field needs-pie" type="search" placeholder="Search" />
                                            <div class="search-filter-wrapper">
                                                <div class="search-filter">
                                                    <div class="search-filter-content">
                                                        <ul>
                                                            <li>All Files</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="search-submit-wrapper" dir="ltr">
                                                <div class="search-submit" title="Search">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <div class="button-group star-buttons loading feedback-topic-required">
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                        </div>
                                                        <div class="button-separator feedback-topic-required">
                                                        </div>
                                                        <button class="button feedback-required login-button" id="normalLoginBtn" data-state1-class="login-button" data-state2-class="edit-user-profile-button" title="Login" data-state1-title="Login">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="login" />
                                                        </button>
                                                        <button class="button needs-pie print-button" title="Print">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                        </button>
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <h1>Tax Version 1.0 <img src="../../resources/images/shoptype/b2b_shop.png" /> <img src="../../resources/images/shoptype/b2c_shop.png" /></h1>
                                                <p><a href="javascript:void(0);" class="MCHelpControl MCHelpControl-Related relatedTopics relatedTopicssideContent" data-mc-topics="Tax Version 2.0   |tax-2-0.htm||tax_1|tax_1.htm" target="_self" style="mc-label: 'Versions:';mc-help-control-display: popup;"><span class="MCHelpControl-RelatedHotSpot_ MCHelpControl-RelatedHotSpot_sideContent"><img class="MCHelpControl_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="16" width="16" alt="Related Topics Link Icon" />Versions:</span></a>
                                                </p>
                                                <p>The Tax module is responsible for handling tax rates that can apply for products, product options or shipment.</p>
                                                <h2><a name="Overview"></a>Overview</h2>
                                                <p>The tax sets can have different tax rates for each country defined in your shop. You can see in the diagram below how these entities are modeled in the database.</p>
                                                <p><a class="MCPopupThumbnailLink MCPopupThumbnailPopup" href="../../resources/images/tax.png" data-mc-popup-alt="Tax database diagram"><img class="MCPopupThumbnail img imgThumbnail" data-mc-width="562" data-mc-height="100" src="../../resources/images/tax_thumb_0_48.png" alt="Tax database diagram" title="Click me" tabindex="" /></a>
                                                </p>
                                                <p>A tax set is defined by a name and is uniquely identified by an <var>id</var>. As its name says, it’s associated to a set of rates. A tax rate is defined by a name, a numeric rate value and it’s linked to a country.</p>
                                                <p>All in one, a tax set contains of collection of tax rates that apply by country.</p>
                                                <p>The <var>SpyTaxSetTax</var> table is used to model the many-to-many relation between tax set and tax rate tables.</p>
                                                <p class="info"><strong>Tax Related Entities</strong>
                                                    <br />There are a couple of entities that have a tax set associated as a foreign key, such as abstract products, product options and shipment methods.</p>
                                                <h2><a name="Implemen"></a>Implementation Details</h2>
                                                <h3>TaxDefault Class</h3>
                                                <p><var>TaxDefault</var> class contains two important operations:</p>
                                                <ul>
                                                    <li class="bullet_list" value="1">getDefaultTaxCountry() - retrieves the default tax country from the configuration file (e.g.: Germany).</li>
                                                    <li class="bullet_list" value="2">getDefaultTaxRate() - retrieved the default tax rate from the configuration file (e.g.: 19%).</li>
                                                </ul>
                                                <p>These methods are called if the tax calculator cannot find the corresponding tax rate for one of the related entities.</p>
                                                <p>These methods can be extended on the project side, depending on your needs.</p>
                                                <h3>Calculator Plugins</h3>
                                                <p>Tax module ships with a set of calculator plugins, dedicated for calculating the taxes for each of the corresponding items in the <var>QuoteTransfer</var>.</p>
                                                <p>The calculators are called to recalculate the taxes every time <var>addToCart()</var> method is called or the payment step is entered. If the customer has changed the country during the address step, this is not an issue because the tax rates are recalculated.</p>
                                                <h4>Calculator Plugins for Tax Rates:</h4>
                                                <ul>
                                                    <li class="bullet_list" value="1"><var>ProductItemTaxCalculatorsPlugin</var> - calculates tax rates based on <var>IdAbstractProduct</var> in the items contained in the <var>QuoteTransfer</var> (Tax module)</li>
                                                    <li class="bullet_list" value="2"><var>ProductIOptionTaxCalculatorsPlugin</var> - calculated tax rates based on <var>IdOptionValueUsage</var> for every product option of the items contained in the QuoteTransfer (ProductOption module)</li>
                                                    <li class="bullet_list" value="3"><var>ShipmentTaxCalculatorsPlugin</var> - calculates tax rates based on the shipment method set in the QuoteTransfer (Shipment module)</li>
                                                </ul>
                                                <p>The calculator plugins are registered in the <var>CalculationDependencyProvider:getCalculatorStack()</var> method.</p>
                                                <h2><a name="Extendin"></a>Extending Tax Module</h2>
                                                <p>One of the most common use cases of extending the Tax module is to provide a custom calculator.</p>
                                                <p>In the coding example below, we’ll implement a calculator that uses a flat tax rate for all the products.</p>
                                                <p>The new calculator plugin must extend the <var>AbstractPlugin</var> class and implement the <var>CalculatorPluginInterface</var>.</p>
                                                <p>In Zed, inside the <var>Tax/Communication/Plugin/</var> folder, create the <var>FlatTaxRateCalculatorPlugin</var> class.</p><pre><code class="language-PHP line-numbers">&lt;?php
...
use Generated\Shared\Transfer\QuoteTransfer;
use Spryker\Zed\Calculation\Dependency\Plugin\CalculatorPluginInterface;
use Spryker\Zed\Kernel\Communication\AbstractPlugin;
...
class NewTaxRateCalculatorPlugin extends AbstractPlugin implements CalculatorPluginInterface
{
...
   public function recalculate(QuoteTransfer $quoteTransfer)
    {
        $this-&gt;getFacade()-&gt;calculateProductItemTaxRate($quoteTransfer);
    }
}</code></pre>
                                                <p>Next, implement the business logic; create the <var>FlatTaxRateCalculator</var> inside the Model folder.</p><pre><code class="language-PHP line-numbers">&lt;?php
...

use Spryker\Zed\Tax\Persistence\TaxQueryContainer;
use Spryker\Zed\Tax\Persistence\TaxQueryContainerInterface;

class FlatTaxRateCalculator implements CalculatorInterface
{
    public function recalculate(QuoteTransfer $quoteTransfer)
    {
       //TODO implement new calculation ….
    }
}</code></pre>
                                                <p>Create a method that returns an instance of the calculator in the factory.</p><pre><code class="language-PHP line-numbers">&lt;?php
class TaxBusinessFactory extends AbstractBusinessFactory
{
    //..

    public function createProductItemTaxRateCalculator()
    {
        return new FlatTaxRateCalculator();
    }
}</code></pre>
                                                <p>Expose this functionality through the facade:</p><pre><code class="language-PHP line-numbers">&lt;?php
class TaxFacade extends AbstractFacade implements TaxFacadeInterface
{
    //..
   public function calculateFlatTaxRate(QuoteTransfer $quoteTransfer)
   {
        $this-&gt;getFactory()-&gt;createFlatTaxRateCalculator()-&gt;recalculate($quoteTransfer);
   }
}</code></pre>
                                                <p>Register the new plugin in the <var>CalculationDependencyProvide:getCalculatorStack()</var> method:</p><pre><code class="language-PHP line-numbers">&lt;?php
class CalculationDependencyProvider extends SprykerCalculationDependencyProvider
{
    protected function getCalculatorStack(Container $container)
    {
        return [
            new FlatTaxRateCalculatorPlugin(),
             ...
        ];
    }

}</code></pre>
                                                <h2><a name="Migratio"></a>Migration Guide</h2>
                                                <p>If you’re migrating the Tax module from version 2 to version 3, you need to follow the steps described in the <a href="mg-tax.htm" target="_blank">migration guide</a>.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>