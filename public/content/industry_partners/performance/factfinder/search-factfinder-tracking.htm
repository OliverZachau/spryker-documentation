<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../" data-mc-has-content-body="True" data-mc-conditions="Spryker.DemoShop,Spryker.B2C" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Industry Partners|Industry Partners|Search Integration - FactFinder">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>FACT-Finder - Tracking  </title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.topic-ratings-button
{
	-pie-background: transparent url('../../../../Skins/Default/Stylesheets/Images/star-full.png') no-repeat center center;
}

.button.separator-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.edit-user-profile-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/edit-profile.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search the Academy" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <script src="../../../resources/prism.js">
                                </script>
                                <div class="search-container">
                                    <form class="search" action="#">
                                        <div class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                            <input class="search-field needs-pie" type="search" placeholder="Search" />
                                            <div class="search-filter-wrapper">
                                                <div class="search-filter">
                                                    <div class="search-filter-content">
                                                        <ul>
                                                            <li>All Files</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="search-submit-wrapper" dir="ltr">
                                                <div class="search-submit" title="Search">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="nocontent">
                                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="bOAZ8nSZgUG3g7AbYG25eg">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="bOAZ8nSZgUG3g7AbYG25eg:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <div class="button-group star-buttons loading feedback-topic-required">
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                        </div>
                                                        <div class="button-separator feedback-topic-required">
                                                        </div>
                                                        <button class="button feedback-required login-button" id="normalLoginBtn" data-state1-class="login-button" data-state2-class="edit-user-profile-button" title="Login" data-state1-title="Login">
                                                            <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="login" />
                                                        </button>
                                                        <button class="button needs-pie print-button" title="Print">
                                                            <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                        </button>
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <h1>FACT-Finder - Tracking <img src="../../../resources/images/shoptype/b2c_shop.png" /> <img src="../../../resources/images/shoptype/demoshop.png" /></h1>
                                                <h2>Prerequisites</h2>
                                                <p>Tracking information lets the FACT-Finder Search tool automatically learn from the user behavior.</p>
                                                <p>The data provided through this interface can be used for a variety of purposes. They include the tracking of events such as users clicking on a detail page, placing a product into the shopping cart and purchasing it. The information can form the basis for automated search optimization. It automatically improves the search result on the basis of the established consumer behavior. Information about product clicks, shopping cart, and purchase events, in other words, the user behavior, is required for the Personalization module, which provides tailored search results for each user. The information on product purchases can also be used as a basis for the Recommendation Engine module.

        </p>
                                                <p class="important">
            Please note, that the personalization can only work if a proper session ID is sent with each search request.
        </p>
                                                <h2>Usage</h2>
                                                <p>By default, you can use the <var>/fact-finder/track</var> route. According to the FACT-Finder documentation, you can use tracking <var>GET</var> parameters . The user session ID will be appended on a server side.</p>
                                                <ul>
                                                    <li value="1"><strong>General Parameters</strong>:<ul><li value="1"><var>id</var> - ID of the item for which information is to be sent.</li><li value="2"><var>masterId</var> (optional) - If your shop contains item versions and you need to transmit the item version number with the id parameter, you will need to transmit the master item number using this parameter to ensure that the products and the possible events can be assigned to each other.</li><li value="3"><var>channel</var> - The name of the FACT-Finder channel in which the search was conducted.</li><li value="4"><var>sid</var> - Use it to pass the user’s session identifier.</li><li value="5"><var>event</var> - This parameter specifies the event type. Use the following values for the various types:<ul><li value="1">click</li><li value="2">cart</li><li value="3">checkout</li><li value="4">login</li><li value="5">recommendationClick</li><li value="6">feedback</li></ul></li><li value="6"><var>title</var> (optional) - The item name.</li><li value="7"><var>userId</var> (optional) - Use it to pass a user identifier. As with the session ID, it can be anonymized.</li><li value="8"><var>cookieId</var> (optional) - You use this parameter to pass a token that identifies the user over a longer period of time, even when not being logged in to the shop.</li></ul></li>
                                                    <li value="2"><b>Click on the detail page</b>:<ul><li value="1"><var>sid</var> - Use it to pass the user’s session identifier.</li><li value="2"><var>query</var> - The search term for which the user has searched.</li><li value="3"><var>pos</var> - The position of the product in the search results.</li><li value="4"><var>origPos</var> - It transmits the original position of the item in the search result.</li><li value="5"><var>page</var> - The number of the search result page on which the selected product was displayed.</li><li value="6"><var>pageSize</var> (optional) - The number of products per search result page at the time the click was executed.</li><li value="7"><var>origPageSize</var> - The default number of products per search result page.</li><li value="8"><var>simi</var> (optional) - The FACT-Finder similarity value for the respective product.</li><li value="9"><var>campaign</var> - This field has the campaign ID as its value.</li></ul></li>
                                                    <li value="3"><b>Shopping basket and purchase information</b>:<ul><li value="1"><var>count</var> - Quantity of product purchased.</li><li value="2"><var>price</var> (optional) - Product price.</li><li value="3"><var>campaign</var> - The search result via a campaign. This field has the campaign ID as its value.</li></ul></li>
                                                    <li value="4"><b>User login</b>:<ul><li value="1"><var>sid</var> - Use this to pass the user’s session identifier.</li><li value="2"><var>userId</var> - Use this to pass a user identifier. Like the session ID, this can be anonymized.</li></ul></li>
                                                    <li value="5"><b>Recommendation Engine click</b>:<ul><li value="1"><var>mainId</var> - ID of the article for which the clicked article was recommended.</li></ul></li>
                                                    <li value="6"><b>Search result feedback</b>:<ul><li value="1"><var>query</var> - The search term for which a search was conducted and on which feedback has been provided.</li><li value="2"><var>positive</var> - Send the value true at this point if the customer provided positive feedback. Send false if negative feedback was provided on the result.</li><li value="3"><var>message</var> (optional) - If the customer left a message as justification of their opinion, you can send it using this parameter.</li></ul></li>
                                                    <li value="7"><b>Shop cachehit</b>:<ul><li value="1"><var>page</var> - The number of the search result page on which the selected product was displayed.</li><li value="2"><var>pageSize</var> - The number of products per search result page at the time the click was executed.</li><li value="3"><var>query</var> - The search term for which a search was conducted and on which feedback has been provided.</li><li value="4"><var>hitCount</var> - The amount of products found in the search result.</li><li value="5"><var>searchTime</var> - The time which was needed to create the search result.</li><li value="6"><var>bestSimi</var> - Similarity of the best product.</li><li value="7"><var>minSimi</var> - Similarity of the last product.</li><li value="8"><var>filterfieldName</var> (optional) - Information about active filters in the search result.</li><li value="9"><var>searchField</var> (optional) - The field for which the search was performed in case the search was limited to a specific field.</li><li value="10"><var>customSorting</var> (optional) - If the default sorting was not used for the search result, then please send a true.</li><li value="11"><var>additionalInfo</var>` (optional) - You may use this parameter to add something to the log entry, such as to enable searching the log for a specific entry.</li></ul></li>
                                                    <li value="8"><b>Suggest Tracking</b>:<ul><li value="1"><var>queryFromSuggest</var> - This parameter indicates that the FACT-Finder query was triggered through a selection from the suggestion list. In this case send the parameter with the value true.</li><li value="2"><var>userInput</var> - Please use this parameter to send the order of letters the shop user entered until the search query was triggered.</li></ul></li>
                                                </ul>
                                                <p>To use tracking on the back end, provide the dependency to your module dependency provider.</p>
                                                <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Click here to expand the code sample</a></span>
                                                    <div class="MCDropDownBody dropDownBody"><pre><code class="language-php line-numbers">&lt;?php

    /**
     * @param \Spryker\Yves\Kernel\Container $container
     *
     * @return \Spryker\Yves\Kernel\Container
     */
    public function provideDependencies(Container $container) {
        $container[self::FACT_FINDER_CLIENT] = function (Container $container) {
            return $container-&gt;getLocator()-&gt;factFinderSdk()-&gt;client();
        };

        return $container;
    }

{% endhighlight %}

Add a new function to your module factory.

{% highlight php linenos %}
&lt;?php

    /**
     * @return \SprykerEco\Client\FactFinderSdk\FactFinderSdkClient
     */
    public function getFactFinderSdkClient()
    {
        return $this-&gt;getProvidedDependency(YourBundleDependencyProvider::FACT_FINDER_CLIENT);
    }
</code></pre>
                                                    </div>
                                                </div>
                                                <p>Then use it. </p>
                                                <p>Login tracking could be added to a Pyz\Yves\Customer\Plugin\Provider\CustomerAuthenticationSuccessHandler onAuthenticationSuccess function</p>
                                                <p>Example of a user login tracking function:</p><pre><code class="language-php line-numbers">&lt;?php

    /**
     * @param \Generated\Shared\Transfer\CustomerTransfer $customer
     * @param Request $request
     *
     * @return void
     */
    protected function trackLogin(CustomerTransfer $customer, Request $request)
    {
        $trackingTransfer = new FactFinderSdkTrackingRequestTransfer();
        $trackingTransfer-&gt;setEvent(CustomerConstants::LOGIN_TRACKING);
        $trackingTransfer-&gt;setSid($request-&gt;cookies-&gt;get(FactFinderConstants::COOKIE_SID_NAME));
        $trackingTransfer-&gt;setUserId(md5($customer-&gt;getEmail()));

        $this-&gt;factFinderSdkClient-&gt;track($trackingTransfer);
    }</code></pre>
                                                <p>Shopping basket tracking function could be added to a Yves\Cart\Handler\CartOperationHandler changeQuantity and add functions.</p>
                                                <p>Add a session client and a fact finder sdk client to the CartOperationHandler class via a DependencyProvider.</p>
                                                <p>Example of an add to cart tracking function</p><pre><code class="language-php line-numbers">&lt;?php

        /**
         * @param \Generated\Shared\Transfer\QuoteTransfer $quoteTransfer
         * @param $sku
         * @param $quantity
         *
         * @return \Generated\Shared\Transfer\FactFinderSdkTrackingResponseTransfer
         */
        protected function trackAddToCart(QuoteTransfer $quoteTransfer, $sku, $quantity)
        {
            $trackItemTransfer = $this-&gt;getCurrentItemTransfer($quoteTransfer, $sku);

            if ($trackItemTransfer) {
                $trackRequestTransfer = new FactFinderSdkTrackingRequestTransfer();
                $trackRequestTransfer-&gt;setId($trackItemTransfer-&gt;getSku())
                    -&gt;setMasterId() // generate and add an abstract product sku
                    -&gt;setEvent(static::CART_TRACK_EVENT_NAME) // static::CART_TRACK_EVENT_NAME === 'cart'
                    -&gt;setCount($quantity)
                    -&gt;setPrice($trackItemTransfer-&gt;getUnitPrice() / 100)
                    -&gt;setSid($this-&gt;sessionClient-&gt;getId());

                return $this-&gt;factFinderSdkClient-&gt;track($trackRequestTransfer);
            }

            return new FactFinderSdkTrackingResponseTransfer();
        }</code></pre>
                                                <p>&#160;</p>
                                                <ul>
                                                    <li value="1"><a href="../../../Industry Partners/Performance/FactFinder/integration_search_factfinder.htm">Get a general idea about FACT-Finder</a>
                                                    </li>
                                                    <li value="2"><a href="../../../Industry Partners/Performance/FactFinder/integration_search_factfinder_recommendation.htm">Configure FACT-Finder recommendations widget</a>
                                                    </li>
                                                    <li value="3"><a href="../../../Industry Partners/Performance/FactFinder/integration_search_factfinder_search.htm">Configure FACT-Finder Search</a>
                                                    </li>
                                                    <li value="4"><a href="../../../Industry Partners/Performance/FactFinder/integration_search_factfinder_suggest.htm">Configure FACT-Finder Suggest module</a>
                                                    </li>
                                                    <li value="5"><a href="../../../Industry Partners/Performance/FactFinder/integration_search_factfinder_campaigns.htm">Configure FACT-Finder Campaign Manager module</a>
                                                    </li>
                                                    <li value="6"><a href="../../../Industry Partners/Performance/FactFinder/integration_search_factfinder_export_csv.htm">Learn how to export CSVs to FACT-Finder</a>
                                                    </li>
                                                </ul>
                                                <p><i>Last review date: Dec. 22nd, 2017</i>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>