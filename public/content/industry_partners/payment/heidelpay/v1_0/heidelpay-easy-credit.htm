<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-conditions="Spryker.B2C,Spryker.DemoShop" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Industry Partners|Industry Partners|Payment Integration - Heidelpay">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Heidelpay - Easy Credit</title>
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/Stylesheets/MadCapSearch.Google.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.topic-ratings-button
{
	-pie-background: transparent url('../../../../../Skins/Default/Stylesheets/Images/star-full.png') no-repeat center center;
}

.button.separator-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.edit-user-profile-button
{
	-pie-background: url('../../../../../Skins/Default/Stylesheets/Images/edit-profile.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapSearch.Google.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form>
                                            <div id="yZvMnnHOy0Gzc1X9vI4_YQ" class="search-bar search-bar-container needs-pie">
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <script src="../../../../resources/prism.js">
                                </script>
                                <div class="search-container">
                                    <form>
                                        <div id="TQ4aybW100uqyIhzMI2Gmw" class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="nocontent">
                                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="3MKQmktmKkKWpjUywNArhA">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="3MKQmktmKkKWpjUywNArhA:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <div class="button-group star-buttons loading feedback-topic-required">
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                        </div>
                                                        <div class="button-separator feedback-topic-required">
                                                        </div>
                                                        <button class="button feedback-required login-button" id="normalLoginBtn" data-state1-class="login-button" data-state2-class="edit-user-profile-button" title="Login" data-state1-title="Login">
                                                            <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="login" />
                                                        </button>
                                                        <button class="button needs-pie print-button" title="Print">
                                                            <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                        </button>
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <h1>Heidelpay - Easy Credit <img src="../../../../resources/images/shoptype/b2c_shop.png" /> <img src="../../../../resources/images/shoptype/demoshop.png" /></h1>
                                                <p>The following configuration should be implemented after Heidelpay has been <a href="heidelpay-installation.htm">installed</a> and <a href="heidelpay-integration.htm">integrated</a>.</p>
                                                <h2>Configuration</h2>
                                                <p>Example (for testing only):</p><pre><code class="language-bash line-numbers">
$config[HeidelpayConstants::CONFIG_HEIDELPAY_TRANSACTION_CHANNEL_EASY_CREDIT] = '31HA07BC810DCA126FA83FA533886979';
				</code></pre>
                                                <p>This value should be taken from HEIDELPAY.</p>
                                                <ol>
                                                    <li value="1">Add new EasyCredit step to StepFactory:</li><pre><code class="language-bash line-numbers">
class StepFactory extends SprykerStepFactory
{
...
/**
 * @return \Spryker\Yves\StepEngine\Process\StepCollectionInterface
 */
public function createStepCollection()
{
	$stepCollection = new StepCollection(
		$this-&gt;getUrlGenerator(),
		CheckoutControllerProvider::CHECKOUT_ERROR
	);

	$stepCollection
		-&gt;addStep($this-&gt;createEntryStep())
		-&gt;addStep($this-&gt;createCustomerStep())
		-&gt;addStep($this-&gt;createAddressStep())
		-&gt;addStep($this-&gt;createShipmentStep())
		-&gt;addStep($this-&gt;createPaymentStep())
		-&gt;addStep($this-&gt;createEasyCreditStep())
		-&gt;addStep($this-&gt;createSummaryStep())
		-&gt;addStep($this-&gt;createPlaceOrderStep())
		-&gt;addStep($this-&gt;createSuccessStep());

	return $stepCollection;
}
</code></pre>
                                                    <li value="2">Add EasyCreditStep Class</li><pre><code class="language-bash line-numbers">
&lt;?php

/**
* This file is part of the Spryker Demoshop.
* For full license information, please view the LICENSE file that was distributed with this source code.
*/

namespace Pyz\Yves\Checkout\Process\Steps;

use Spryker\Shared\Kernel\Transfer\AbstractTransfer;
use Spryker\Yves\StepEngine\Dependency\Step\StepWithExternalRedirectInterface;
use SprykerEco\Client\Heidelpay\HeidelpayClientInterface;
use SprykerEco\Shared\Heidelpay\HeidelpayConfig;
use Symfony\Component\HttpFoundation\Request;

class EasyCreditStep extends AbstractBaseStep implements StepWithExternalRedirectInterface
{
	/**
	 * @var string
	 */
	protected $externalRedirect;

	/**
 	 * @var \SprykerEco\Client\Heidelpay\HeidelpayClientInterface
 	 */
	private $heidelpayClient;

	/**
	 * @param HeidelpayClientInterface $heidelpayClient
	 * @param $stepRoute
	 * @param $escapeRoute
	 */
	public function __construct(
		HeidelpayClientInterface $heidelpayClient,
		$stepRoute,
		$escapeRoute
	) {
		parent::__construct($stepRoute, $escapeRoute);

		$this-&gt;heidelpayClient = $heidelpayClient;
	}

	/**
	 * Require input for customer authentication if the customer is not logged in already, or haven't authenticated yet.
	 *
	 * @param \Spryker\Shared\Kernel\Transfer\AbstractTransfer $quoteTransfer
	 *
	 * @return bool
	 */
	public function requireInput(AbstractTransfer $quoteTransfer)
	{
		return false;
	}

	/**
	 * @param \Symfony\Component\HttpFoundation\Request $request
	 * @param \Spryker\Shared\Kernel\Transfer\AbstractTransfer $quoteTransfer
	 *
	 * @return \Spryker\Shared\Kernel\Transfer\AbstractTransfer
	 */
	public function execute(Request $request, AbstractTransfer $quoteTransfer)
	{
		if ($quoteTransfer-&gt;getPayment()-&gt;getPaymentSelection() !== HeidelpayConfig::PAYMENT_METHOD_EASY_CREDIT) {
			return $quoteTransfer;
		}

		$transfer = $this-&gt;heidelpayClient-&gt;heidelpayEasycreditRequest($quoteTransfer);
		$this-&gt;externalRedirect = $transfer-&gt;getPaymentFormUrl();

		return $quoteTransfer;
	}

	/**
	 * The customer step is considered done (return true) if he QuoteTransfer contains a non empty CustomerTransfer.
	 * If the CustomerTransfer is guest and the customer is logged in, then we override the guest customer with the
	 * logged in customer, e.g. return false and execute() will do the rest.
	 *
	 * @param \Spryker\Shared\Kernel\Transfer\AbstractTransfer|\Generated\Shared\Transfer\QuoteTransfer $quoteTransfer
	 *
	 * @return bool
	 */
	public function postCondition(AbstractTransfer $quoteTransfer)
	{
		return true;
	}

	/**
	 * Return external redirect url, when redirect occurs not within same application. Used after execute.
	 *
	 * @return string
	 */
	public function getExternalRedirectUrl()
	{
		return $this-&gt;externalRedirect;
	}
}
</code></pre>
                                                </ol>
                                                <h2>Checkout Payment Step Display</h2>
                                                <p>Displays payment method name with a radio button. No extra input fields are required.</p>
                                                <h2>Payment Step Submitting</h2>
                                                <p>No extra actions needed, quote being filled with payment method selection as default. After selecting Easy Credit as a payment method "HP.IN" request will be sent. In the response Heidelpay returns an URL string which defines where customer has to be redirected. If everything was ok user will be redirected to the Easy Credit Externally.</p>
                                                <h2>Summary Review and Order Submitting</h2>
                                                <p>Once the customer is redirected back to us, response from Easy Credit is sent to the Heidelpay and Heidelpay makes a synchronous POST request to the shop's "CONFIG_HEIDELPAY_PAYMENT_RESPONSE_URL" URL (Yves), with the result of payment (see EasyCreditController::paymentAction()). This is called "external response transaction", the result will be persisted in spy_payment_heidelpay_transaction_log as usual. The most important data here - is the payment reference ID which can be used for further transactions like finalize/reserve/etc.</p>
                                                <p>After that customer will be able to see the order summary page, where they can review all related data.</p>
                                                <p>There user will see:</p>
                                                <ul>
                                                    <li value="1">rate plan (CRITERION.EASYCREDIT_AMORTISATIONTEXT)</li>
                                                    <li value="2">interest fees (CRITERION_EASYCREDIT_ACCRUINGINTEREST)</li>
                                                    <li value="3">total sum including the interest fees (CRITERION.EASYCREDIT_TOTALAMOUNT)</li>
                                                </ul>
                                                <p>If the customer has not yet completed the HP.IN they must do that again.</p>
                                                <p><u style="font-weight: bold;">On "save order" event</u> - save Heidelpay payment per order and items, as usual.</p>
                                                <p><b>When state machine is initialized</b>, an event "send authorize on registration request" will trigger the authorize on registration request. In case of success, state will be changed.</p>
                                                <p>Finalize - later on, when the item is shipped to the customer, it is time to call "finalize" command of the state machine. This will send HP.FI request to the Payment API. This is done in FinalizePlugin of the OMS command.</p>
                                                <p>&#160;</p>
                                                <p><b>See also:</b>
                                                </p>
                                                <ul>
                                                    <li value="1"><a href="../../../../Industry Partners/Payment/Heidelpay/integration_payment_heidelpay.htm" class="MCXref xref">Payment Integration - Heidelpay</a>
                                                    </li>
                                                    <li value="2"><a href="../../../../Industry Partners/Payment/Heidelpay/v1_0/integration_payment_heidelpay_installation.htm" class="MCXref xref">Heidelpay - Installation</a>
                                                    </li>
                                                    <li value="3"><a href="heidelpay-integration.htm" class="MCXref xref">Heidelpay - Integration to Your Project
 </a>
                                                    </li>
                                                    <li value="4"><a href="#" class="MCXref xref" xrefformat="{para}">Heidelpay - Easy Credit  </a>
                                                    </li>
                                                    <li value="5"><a href="../../../../Industry Partners/Payment/Heidelpay/v1_0/integration_payment_heidelpay_credit_card.htm" class="MCXref xref">Heidelpay - Credit Card Secure</a>
                                                    </li>
                                                    <li value="6"><a href="../../../../Industry Partners/Payment/Heidelpay/v1_0/integration_payment_heidelpay_ideal.htm" class="MCXref xref">Hedelpay - iDeal</a>
                                                    </li>
                                                    <li value="7"><a href="../../../../Industry Partners/Payment/Heidelpay/v1_0/integration_payment_heidelpay_paypal_debit.htm" class="MCXref xref">Heidelpay - Paypal Debit Workflow</a>
                                                    </li>
                                                    <li value="8"><a href="../../../../Industry Partners/Payment/Heidelpay/v1_0/integration_payment_heidelpay_sofortuberweisung.htm" class="MCXref xref">Heidelay - Sofort (Online Transfer)</a>
                                                    </li>
                                                </ul>
                                                <p>&#160;</p>
                                                <p><i>Last
        review date: Sep. 19th, 2018</i>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>