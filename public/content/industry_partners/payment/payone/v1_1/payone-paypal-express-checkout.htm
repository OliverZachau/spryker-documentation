<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../../../" data-mc-has-content-body="True" data-mc-conditions="Spryker.DemoShop,Spryker.B2C" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Industry Partners|Industry Partners|Payment Integration - BS PayOne">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>PayOne - PayPal Express Checkout Payment</title>
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/Stylesheets/MadCapSearch.Google.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.topic-ratings-button
{
	-pie-background: transparent url('../../../../../Skins/Default/Stylesheets/Images/star-full.png') no-repeat center center;
}

.button.separator-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.edit-user-profile-button
{
	-pie-background: url('../../../../../Skins/Default/Stylesheets/Images/edit-profile.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapSearch.Google.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form>
                                            <div id="vAkLnJTpc0OJ1vI0lbaPlg" class="search-bar search-bar-container needs-pie">
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <script src="../../../../resources/prism.js">
                                </script>
                                <div class="search-container">
                                    <form>
                                        <div id="SiKWtynq6EWjd_mjANQaDw" class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="nocontent">
                                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="Nm_FFvPxP0uhglwjc4q_pA">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="Nm_FFvPxP0uhglwjc4q_pA:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <div class="button-group star-buttons loading feedback-topic-required">
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                        </div>
                                                        <div class="button-separator feedback-topic-required">
                                                        </div>
                                                        <button class="button feedback-required login-button" id="normalLoginBtn" data-state1-class="login-button" data-state2-class="edit-user-profile-button" title="Login" data-state1-title="Login">
                                                            <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="login" />
                                                        </button>
                                                        <button class="button needs-pie print-button" title="Print">
                                                            <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                        </button>
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <h1>PayOne - PayPal Express Checkout Payment <img src="../../../../resources/images/shoptype/b2c_shop.png" /> <img src="../../../../resources/images/shoptype/demoshop.png" /></h1>
                                                <p><a href="javascript:void(0);" class="MCHelpControl MCHelpControl-Related relatedTopics" data-mc-topics="integration_payment_payone_paypal_express_checkout|../v1_0/integration_payment_payone_paypal_express_checkout.htm" target="_blank" style="mc-label: 'Versions';"><span class="MCHelpControl-RelatedHotSpot_"><img class="MCHelpControl_Image_Icon" src="../../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="16" width="16" alt="Related Topics Link Icon" />Versions</span></a>
                                                </p>
                                                <p>The payment using PayPal requires redirect to PayPal website. When the customer is redirected to PayPal’s website, he must authorize himself and he has the option to either cancel or validate the transaction.</p>
                                                <p>A concern regarding payment flows that require redirection on third party website pages is that you loose control over the customer's action (the customer can close the browser before accepting or canceling the transaction). If this is the case, PayPal sends an instant payment notification (IPN) to Payone, then Payone notifies Spryker.</p>
                                                <h2>Front-end Integration</h2>
                                                <p>To adjust the frontend appearance, add the following templates in your theme directory:</p>
                                                <p><var>src/&lt;project_name&gt;/Yves/Cart/Theme/&lt;custom_theme_name&gt;/cart/parts/cart-summary.twig</var>
                                                </p>
                                                <p>Add the following code below the checkout button or anywhere you want depending on your design:</p>
                                                <p><pre><code class="language-php line-numbers">{{ render(path('payone-checkout-with-paypal-button')) }}</code></pre>
                                                </p>
                                                <p>You can also implement your own button if you want the button to be loaded without separate call to the controller, or if you want to change the design.</p>
                                                <h2>Paypal Express Checkout Flow Description:</h2>
                                                <ul>
                                                    <li value="1"> Once you click on the "Checkout with PayPal" button, the genericpayment request is sent to Payone with <var>setexpresscheckout</var> action and success, failure and back URLs.</li>
                                                    <li value="2"> In the response we receive a workorderid which is used for all other operations until the capture request and PayPal redirect URL.</li>
                                                    <li value="3"> We store wordorderid to quote and redirect customer to the URL provided by Payone.</li>
                                                    <li value="4"> On the PayPal page, customer has to log in and approve the intention of paying for the desired goods.</li>
                                                    <li value="5"> After the customer clicks the button, he is redirected to success or failure URL, provided by the shop in the first request to Payone.</li>
                                                    <li value="6"> After redirection to success action, one more genericpayment request to Payone is made with action <var>getexpresscheckoutdetails</var>.</li>
                                                    <li value="7"> Payone sends us information about the customer like email and shipment data.</li>
                                                    <li value="8"> User is redirected to the page(summary page as default) of standard checkout.</li>
                                                    <li value="9"> After placing the order, the pre-authorization call is sent to Payone (and through it to PayPal). Workorderid is sent to Payone with this request.</li>
                                                    <li value="10"> Order status becomes "pre-authorized pending" after the response with status OK is received.</li>
                                                </ul>
                                                <h2>State Machine Integration</h2>
                                                <p>Payone <span class="Generalbundle/module">module</span> provides a demo state machine for Paypal Express Checkout payment method which implements Preauthorization/Capture flow.</p>
                                                <p>To enable the demo state machine, extend the configuration with the following values:</p><pre><code class="language-php line-numbers">&lt;?php
$config[SalesConstants::PAYMENT_METHOD_STATEMACHINE_MAPPING] = [
    ...
    PayoneConfig::PAYMENT_METHOD_PAYPAL_EXPRESS_CHECKOUT =&gt; 'PayonePaypalExpressCheckout',
];

$config[OmsConstants::ACTIVE_PROCESSES] = [
    ...
    'PayonePaypalExpressCheckout',
];
    </code></pre>
                                                <p>Note: You can find all needed configuration parameters in <var>config.dist.php</var> file inside Payone module.</p>
                                                <h2>Configuration Parameters Description:</h2>

        To understand where to go, if control over express checkout process should be handed over to the project,
        Payone module needs several urls to be confgured in the global config:
        <p><b>PayoneConstants::PAYONE_STANDARD_CHECKOUT_ENTRY_POINT_URL</b> - URL, which is used when express checkout details are loaded to quote.
            Normally, its an URL to summary page or to some middleware URL, where additional logic can be added before going to checkout (e.g. filling some post conditions which are required to get to summary page in Spryker step-engine).
        </p><p><b>PayoneConstants::PAYONE_EXPRESS_CHECKOUT_FAILURE_URL</b> - URL where user is redirected when payone fails for some reason.</p><p><b>PayoneConstants::PAYONE_EXPRESS_CHECKOUT_BACK_URL</b> - URL where user is redirected when he/she goes back to Paypal side. </p><pre><code class="language-php line-numbers">
    $config[PayoneConstants::PAYONE][PayoneConstants::PAYONE_STANDARD_CHECKOUT_ENTRY_POINT_URL] = sprintf(
    '%s/checkout/paypal-express-checkout-entry-point',
    $config[ApplicationConstants::BASE_URL_YVES]
);
            <br />$config[PayoneConstants::PAYONE][PayoneConstants::PAYONE_EXPRESS_CHECKOUT_FAILURE_URL] = sprintf(
    '%s/cart',
    $config[ApplicationConstants::BASE_URL_YVES]
);
                <br />$config[PayoneConstants::PAYONE][PayoneConstants::PAYONE_EXPRESS_CHECKOUT_BACK_URL] = sprintf(
    '%s/cart',
    $config[ApplicationConstants::BASE_URL_YVES]
);
                <br /></code></pre><h2>Extra Configuration:</h2>

       To add possibility to skip standard checkout steps for guest user, customer step should be extended:
        <p>Open <b>Yves/Checkout/Process/Steps/CustomerStep.php</b> file in your project and add the following code to <b>postCondition</b> and <b>requireInput</b> methods:</p><pre><code class="language-php line-numbers">
  public function requireInput(AbstractTransfer $quoteTransfer)
  {
      if ($this-&gt;isCustomerLoggedIn() || $quoteTransfer-&gt;getIsGuestExpressCheckout()) {
          return false;
      }

      return true;
  }
        </code></pre><pre><code class="language-php line-numbers">
  public function postCondition(AbstractTransfer $quoteTransfer)
  {
      if ($this-&gt;isCustomerInQuote($quoteTransfer) === false) {
          return false;
      }

      if ($quoteTransfer-&gt;getIsGuestExpressCheckout()) {
                    return true;
      }

      if ($this-&gt;isGuestCustomerSelected($quoteTransfer)) {
          if ($this-&gt;isCustomerLoggedIn()) {
              // override guest user with logged in user
              return false;
          }

          return true;
      }
          ...
  }
        </code></pre><p>&#160;</p><p><strong>See also:</strong></p><ul><li value="1"><a href="../../../../Industry Partners/Payment/PayOne/v1_0/integration_payment_payone_paypal_express_checkout.htm" class="MCXref xref">PayPal Express Checkout Payment - Payone - 1.0</a></li><li value="2"><a href="../../../../Industry Partners/Payment/PayOne/v1_1/integration_with_project_example.htm" class="MCXref xref">Integration With Project - Payone</a></li></ul><p>&#160;</p><p><i>Last review date: Mar. 28th, 2018</i></p></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>