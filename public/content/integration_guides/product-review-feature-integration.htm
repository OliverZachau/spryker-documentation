<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Migration and Integration|Migration and Integration|Integration Guides">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Feature Integration - Product Reviews</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/Stylesheets/MadCapSearch.Google.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.topic-ratings-button
{
	-pie-background: transparent url('../../Skins/Default/Stylesheets/Images/star-full.png') no-repeat center center;
}

.button.separator-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.edit-user-profile-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/edit-profile.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
        <script src="../../Resources/Scripts/MadCapSearch.Google.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form>
                                            <div id="4bsr8nlLcU-V7OHdzL2vPQ" class="search-bar search-bar-container needs-pie">
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <script src="../resources/prism.js">
                                </script>
                                <div class="search-container">
                                    <form>
                                        <div id="-0y83yy7N0G11vs56XMlrw" class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="nocontent">
                                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="FBN5zsa-80mCUkGB7V8Uig">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="FBN5zsa-80mCUkGB7V8Uig:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <div class="button-group star-buttons loading feedback-topic-required">
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                        </div>
                                                        <div class="button-separator feedback-topic-required">
                                                        </div>
                                                        <button class="button feedback-required login-button" id="normalLoginBtn" data-state1-class="login-button" data-state2-class="edit-user-profile-button" title="Login" data-state1-title="Login">
                                                            <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="login" />
                                                        </button>
                                                        <button class="button needs-pie print-button" title="Print">
                                                            <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                        </button>
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <h1>Feature Integration - Product Reviews</h1>
                                                <h2>Prerequisites</h2>
                                                <p>To prepare your project to work with Product Reviews:</p>
                                                <ol>
                                                    <li value="1">Require the Product Review modules in your <var>composer</var> by running
            <ul><li value="1"><var>composer require spryker/product-review</var></li><li value="2"><var>composer require spryker/product-review-collector</var></li><li value="3"><var>composer require spryker/product-review-gui</var></li></ul></li>
                                                    <li value="2">Install the new database tables by running <var>vendor/bin/console propel:diff</var>. Propel should generate a migration file with the changes.</li>
                                                    <li value="3">Run <var>vendor/bin/console propel:migrate</var> to apply the database changes.</li>
                                                    <li value="4">Generate ORM models by running <var>vendor/bin/console propel:model:build</var>.
            <p>This command will generate some new classes in your project under <var>\Orm\Zed\ProductReview\Persistence</var> namespace.
                    It is important to make sure that they extend the base classes from the Spryker core, e.g.:</p><ul><li value="1"><var>\Orm\Zed\ProductReview\Persistence\SpyProductReview</var> extends <var>\Spryker\Zed\ProductReview\Persistence\Propel\AbstractSpyProductReview</var></li><li value="2"><var>\Orm\Zed\ProductReview\Persistence\SpyProductReviewQuery</var> extends <var>\Spryker\Zed\ProductReview\Persistence\Propel\AbstractSpyProductReviewQuery</var></li></ul></li>
                                                    <li value="5">Run <var>vendor/bin/console transfer:generate</var> to generate the new transfer objects.</li>
                                                    <li value="6">
            Activate the product review collectors by adding the <var>ProductReviewCollectorSearchPlugin </var>and the <var>ProductAbstractReviewCollectorStoragePlugin </var>to the Storage and Search Collector plugin stack.
            <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Example: collector plugin list extension</a></span><div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">&lt;?php

    namespace Pyz\Zed\Collector;

    use Spryker\Zed\Collector\CollectorDependencyProvider as SprykerCollectorDependencyProvider;
    use Spryker\Zed\Kernel\Container;
    use Spryker\Zed\ProductReviewCollector\Communication\Plugin\ProductReviewCollectorSearchPlugin;
    use Spryker\Zed\ProductReviewCollector\Communication\Plugin\ProductAbstractReviewCollectorStoragePlugin;
    // ...

    class CollectorDependencyProvider extends SprykerCollectorDependencyProvider
    {
        /**
         * @param \Spryker\Zed\Kernel\Container $container
         *
         * @return \Spryker\Zed\Kernel\Container
         */
        public function provideBusinessLayerDependencies(Container $container)
        {
            // ...

            $container[static::SEARCH_PLUGINS] = function (Container $container) {
                return [
                    // ...
                    ProductReviewConfig::RESOURCE_TYPE_PRODUCT_REVIEW =&gt; new ProductReviewCollectorSearchPlugin(),
                ];
            };

            $container[static::STORAGE_PLUGINS] = function (Container $container) {
                return [
                    // ...
                    ProductReviewConfig::RESOURCE_TYPE_PRODUCT_ABSTRACT_REVIEW =&gt; new ProductAbstractReviewCollectorStoragePlugin(),
                ];
            };


            // ...
        }
    }</code></pre></div></div></li>
                                                    <li value="7">Run <var>vendor/bin/console setup:search</var> to set up Search before you run Search collectors.</li>
                                                    <li value="8">Make sure the new Zed user interface assets are built by running <var>npm run zed</var> (or antelope build zed for older versions).</li>
                                                    <li value="9">Update Zed’s navigation cache to show the new items for the Product Review management user interface by running <var>vendor/bin/console application:build-navigation-cache</var>.</li>
                                                </ol>
                                                <p>You should now be able to use the Zed API of Product Reviews to approve, reject and delete reviews, and the collectors should also be able to push approved reviews and ratings into Storage and Search.
        Check out our <a href="https://github.com/spryker/demoshop">Demoshop implementation</a> for frontend implementation example and idea.</p>
                                                <h2>Usage in Yves</h2>
                                                <h3>Submitting a Product Review</h3>
                                                <p>To store an already validated product review, populate a <var>\Generated\Shared\Transfer\ProductReviewTransfer</var> transfer object and send it to Zed by calling the <var>\Spryker\Client\ProductReview\ProductReviewClientInterface::submitCustomerReview</var> method.</p>
                                                <p>This action will create a new pending product review in your persistent storage. The saved product review will be exported to Search and Storage after it was approved on Zed UI.</p>
                                                <p>Make sure that the provided <var>rating</var> value does not exceed the <a href="product-review-feature-configuration.htm#configure-maximum-rating">configured maximum rating</a> limit.</p>      Example of how to store a validated customer review:
			<pre><code class="language-PHP line-numbers">&lt;?php

    /**
     * @method \Pyz\Yves\ProductReview\ProductReviewFactory getFactory()
     */
    class SubmitController extends Pyz\Yves\Application\Controller\AbstractController
    {
        /**
         * @param \Symfony\Component\HttpFoundation\Request $request
         */
        public function submitAction(Request $request)
        {
            $customerReference = $this-&gt;getFactory()-&gt;getCustomerClient()-&gt;getCustomer()-&gt;getCustomerReference();

            $this-&gt;getFactory()-&gt;getProductReviewClient()-&gt;submitCustomerReview(
                (new ProductReviewRequestTransfer())
                        -&gt;setCustomerReference($customerReference)
                        -&gt;setLocaleName($this-&gt;getLocale())
                        -&gt;setIdProductAbstract($request-&gt;attributes-&gt;get('idProductAbstract'))
                        -&gt;setSummary($request-&gt;attributes-&gt;get('summary'))
                        -&gt;setDescription($request-&gt;attributes-&gt;get('description'))
                        -&gt;setRating($request-&gt;attributes-&gt;get('rating'))
                        -&gt;setNickname($request-&gt;attributes-&gt;get('nickname'))
            );
        }
    }
            </code></pre><h3>Displaying an Average Rating</h3><p>To display the average rating stored in Storage, you will need to use <var>spyProductAbstractReview</var> and <var>spyProductAbstractReviewMaximumRating</var> twig extensions shipped by <var>ProductReview</var> module.</p><p><var>spyProductAbstractReview</var> twig extension takes product abstract ID as first argument and injects the corresponding <var>ProductAbstractReviewTransfer</var> transfer object into the twig template provided as the second argument.</p><p><var>spyProductAbstractReviewMaximumRating</var> twig extension allows you to retrieve the <a href="product-review-feature-configuration.htm#configure-maximum-rating">configured maximum rating</a> on demand.</p><p>To register these plugins, you need to add <var>ProductAbstractReviewTwigServiceProvider</var> service provider to your <var>\Pyz\Yves\Application\YvesBootstrap.php</var>.</p>Example of how to register twig extensions:<pre><code class="language-PHP line-numbers">&lt;?php
    namespace Pyz\Yves\Application;

    use Spryker\Yves\ProductReview\Plugin\Provider\ProductAbstractReviewTwigServiceProvider;

    class YvesBootstrap
    {
        /**
         * @return void
         */
        protected function registerServiceProviders()
        {
            // ...
            $this-&gt;application-&gt;register(new ProductAbstractReviewTwigServiceProvider());
        }

    }
                    </code></pre><p>Now you will be able to call the registered <var>spyProductAbstractReview</var> and <var>spyProductAbstractReviewMaximumRating</var> twig extensions in your twig templates.</p>Below is the example <var>spyProductAbstractReview</var> call.<p>@ProductReview/index/index.twig:</p><pre><code class="language-html line-numbers">
&lt;div&gt;Product name: {{product.name}}&lt;/div&gt;
{{ spyProductAbstractReview(product.idProductAbstract, '@ProductReview/partials/average-rating.twig') }}
                </code></pre><p>The <var>spyProductAbstractReview</var> twig extension will render the template provided as a second argument and inject the <var>productAbstractReviewTransfer</var> variable.</p>Below is the example average-rating.twig implementation.<p>@ProductReview/partials/average-rating.twig:</p><pre><code class="language-html line-numbers">
{% block content %}
    {% if productAbstractReviewTransfer %}
        Average product rating is {{ productAbstractReviewTransfer.averageRating }} out of {{ spyProductAbstractReviewMaximumRating() }}
    {% endif %}
{% endblock %}
            </code></pre><h3>Displaying Reviews and Rating Summary</h3><p>To display previously posted and already approved reviews from Search, you will need to call <var>\Spryker\Client\ProductReview\ProductReviewClientInterface::findProductReviewsInSearch</var> method.</p><p>To alter the retrieved number of product reviews per page, change the <a href="product-review-feature-configuration.htm#configure-elements-per-page">Client configuration</a>.</p>Example of product review retrieval:<pre><code class="language-PHP line-numbers">
namespace Pyz\Yves\ProductReview\Controller;

use Generated\Shared\Transfer\ProductReviewSearchRequestTransfer;
use Pyz\Yves\Application\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Request;

/**
 * @method \Spryker\Client\ProductReview\ProductReviewClientInterface getClient()
 */
class IndexController extends AbstractController
{

    /**
     * @param \Symfony\Component\HttpFoundation\Request $request
     *
     * @return array
     */
    public function indexAction(Request $request)
    {
        $productReviews = $this-&gt;getClient()-&gt;findProductReviewsInSearch(
            (new ProductReviewSearchRequestTransfer())
                -&gt;setIdProductAbstract($request-&gt;attributes-&gt;get('idProductAbstract'));
                -&gt;setRequestParams($request-&gt;query-&gt;all())
        );

        return [
            'productReviews' =&gt; $productReviews['productReviews'],
            'pagination' =&gt; $productReviews['pagination'],
            'ratingAggregation' =&gt; $productReviews['ratingAggregation'],
        ];
    }

}

            </code></pre><p>&#160;</p><p><![CDATA[
		
		]]><i>Last review date: Aug. 28, 2017 </i></p></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>