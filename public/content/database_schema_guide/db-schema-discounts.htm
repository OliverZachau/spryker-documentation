<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developer Guide|Database Schema Guide">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Discounts Schema</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/Stylesheets/MadCapSearch.Google.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.topic-ratings-button
{
	-pie-background: transparent url('../../Skins/Default/Stylesheets/Images/star-full.png') no-repeat center center;
}

.button.separator-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.edit-user-profile-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/edit-profile.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <link href="../resources/tablestyles/patternedrows.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
        <script src="../../Resources/Scripts/MadCapSearch.Google.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form>
                                            <div id="qoOAI18630aRX-jSHjcURQ" class="search-bar search-bar-container needs-pie">
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <script src="../resources/prism.js">
                                </script>
                                <div class="search-container">
                                    <form>
                                        <div id="_nXjx-2Gp0-jodfTJK3bZg" class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="nocontent">
                                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="gKrtXF57Y0SYjGdNaI4M_A">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="gKrtXF57Y0SYjGdNaI4M_A:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <div class="button-group star-buttons loading feedback-topic-required">
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                        </div>
                                                        <div class="button-separator feedback-topic-required">
                                                        </div>
                                                        <button class="button feedback-required login-button" id="normalLoginBtn" data-state1-class="login-button" data-state2-class="edit-user-profile-button" title="Login" data-state1-title="Login">
                                                            <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="login" />
                                                        </button>
                                                        <button class="button needs-pie print-button" title="Print">
                                                            <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                        </button>
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <h1>Discounts Schema</h1>
                                                <h2><a name="Discount"></a><b>Discounts</b>
                                                </h2>
                                                <h3><a name="Overview"></a><span style="color: #e35d44;">Overview</span>
                                                </h3>
                                                <p class="info">Discounts are applied during the checkout either manually by the customer via Voucher code or automatically as Cart Rule. In both cases, the discount can have a fixed or a percentage value which is applied for all items or a subset that can be defined with a query string (e.g. only products with a specific attribute). Discounts can be toggled per store.</p>
                                                <p>The main process works like this:</p>
                                                <table style="width: 100%;mc-table-style: url('../resources/tablestyles/patternedrows.css');" class="TableStyle-PatternedRows" cellspacing="0">
                                                    <col class="TableStyle-PatternedRows-Column-Regular" />
                                                    <col class="TableStyle-PatternedRows-Column-Regular" />
                                                    <col class="TableStyle-PatternedRows-Column-Regular" />
                                                    <tbody>
                                                        <tr class="TableStyle-PatternedRows-Body-LightRows">
                                                            <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows">1</td>
                                                            <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows"><b>Find applicable discounts</b>
                                                            </td>
                                                            <td class="TableStyle-PatternedRows-BodyD-Regular-LightRows">Find all active Discounts that can be used for the Quote by checking the entered <b>Code</b> and evaluation of the <b>Query String</b> (boolean condition).</td>
                                                        </tr>
                                                        <tr class="TableStyle-PatternedRows-Body-DarkerRows">
                                                            <td class="TableStyle-PatternedRows-BodyE-Regular-DarkerRows">2</td>
                                                            <td class="TableStyle-PatternedRows-BodyE-Regular-DarkerRows"><b>Collection &amp; Calculation</b>
                                                            </td>
                                                            <td class="TableStyle-PatternedRows-BodyD-Regular-DarkerRows">
                                                                <p><b>Collection</b> of discountable items from the Quote and then <b>Calculation</b> of the discounted amount for each applicable Discount.</p>
                                                                <p class="note">Example: There is a Discount which says "10% on T-Shirts". So first we need to <b>collect</b> these items which can be discounted - T-Shirts in this case - and then the amount needs to be <b>calculated</b> (10% on the price of the T-Shirts; not the whole Quote).</p>
                                                            </td>
                                                        </tr>
                                                        <tr class="TableStyle-PatternedRows-Body-LightRows">
                                                            <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows">3</td>
                                                            <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows"><b>Filter</b>
                                                            </td>
                                                            <td class="TableStyle-PatternedRows-BodyD-Regular-LightRows">
                                                                <p>When more than one Discounts are applicable then there are two scenarios:
</p>
                                                                <ol>
                                                                    <li value="1">If one of the Discounts is marked as <b>Exclusive</b> then only this one is used (If more then one are exclusive then the one with the highest Discount amount is used)</li>
                                                                    <li value="2">If none of the Discounts is exclusive, then all Discounts are used</li>
                                                                </ol>
                                                            </td>
                                                        </tr>
                                                        <tr class="TableStyle-PatternedRows-Body-DarkerRows">
                                                            <td class="TableStyle-PatternedRows-BodyB-Regular-DarkerRows">4</td>
                                                            <td class="TableStyle-PatternedRows-BodyB-Regular-DarkerRows"><b>Distribution</b>
                                                            </td>
                                                            <td class="TableStyle-PatternedRows-BodyA-Regular-DarkerRows">
                                                                <p>The filtered Discounts are distributed on those items that have been collected. See <a href="db-schema-sales.htm">Sales Schema</a> to understand the resulting data structure. </p>
                                                                <p class="note">When more than one discount was calculated it's important to know that each discount was calculated based on the price of the collected items. So it does not matter in which order the Discounts are applied.</p>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                                <h3><a name="Cart"></a><span style="color: #e35d44;">Cart Rule</span>
                                                </h3>
                                                <p class="info">A cart rule is a discount that is automatically added to the quote if certain conditions are satisfied. These conditions can be entered as a query string. For instance, you can say that the cart rule is applied if the subtotal is higher than an amount and the day-of-the-week is Tuesday. Alternatively, you can also define an SKU and a quantity to promote specific products directly.</p>
                                                <p>
                                                    <img src="../resources/images/databaase_schema_guide/cart-rule.png" />
                                                </p>
                                                <p><b>Structure</b>:</p>
                                                <ul>
                                                    <li value="1">The table <i>spy_discount</i> contains the name, validity and other information:</li>
                                                    <ul>
                                                        <li value="1"><i>is_exclusive</i> - Flag that marks a Discount as exclusive.</li>
                                                        <li value="2"><i>discount_type</i> - Cart Rule or Voucher.</li>
                                                        <li value="3"><i>calculator_plugin</i> - A plugin that represents the calculation. We ship with a fix and a percentage calculator plugin.</li>
                                                        <li value="4"><i>decision_rule_query_string</i> - A boolean expression that decides if a discount can be applied (e.g. sku="*" AND sub_total &gt; 100).</li>
                                                        <li value="5"><i>collector_query_string</i> - A boolean expression that defined which products can be discounted (e.g. attribute.color = "white").</li>
                                                        <li value="6"><i>amount</i> - Percentage value (e.g. 10% Discount).</li>
                                                        <li value="7"><i>fk_store</i> -  Not used.</li>
                                                    </ul>
                                                    <li value="2">There is a many-to-many relation between Discounts and Stores.</li>
                                                    <li value="3">The money value of a Discount is saved as <i>gross_amount</i> and <i>net_amount</i> per currency.</li>
                                                </ul>
                                                <h3><a name="Voucher"></a><span style="color: #e35d44;">Voucher Codes</span>
                                                </h3>
                                                <p class="info">A Voucher Code is basically the same as a Cart Rule but with a code which needs to be entered by the user.</p>
                                                <p>
                                                    <img src="../resources/images/databaase_schema_guide/voucher-codes.png" />
                                                </p>
                                                <p><b>Structure</b>:</p>
                                                <ul>
                                                    <li value="1">Discounts are Vouchers if they have the <i>discount_type=voucher</i> and they are related to a Voucher Pool.</li>
                                                    <li value="2">A Voucher Pool has a name and a set of Vouchers.</li>
                                                    <li value="3">A Voucher is identified by its code.</li>
                                                    <ul>
                                                        <li value="1"><i>max_number_of_uses</i> - Defines how often the Voucher can be used. If set to null then the Voucher Code can be used unlimited.</li>
                                                        <li value="2"><i>number_of_uses</i> - Counts how often the Voucher was used already.</li>
                                                    </ul>
                                                </ul>
                                                <p class="note">There are two typical scenarios:</p>
                                                <ol>
                                                    <li value="1">A Voucher Pool with one Voucher Code that can be used unlimited times. This one is usually used for broadcast marketing (e.g. used in TV spots).</li>
                                                    <li value="2">A Voucher Pool with a high number of Voucher Codes which be used once. This one is usually used for direct marketing (e.g. emails to customers).</li>
                                                </ol>
                                                <h3><a name="Discount2"></a><span style="color: #e35d44;">Discount Promotion</span>
                                                </h3>
                                                <p>Discount Promotion extends the Discount feature with product promotion functionality. Discount promotions add the ability to give away discounted or even free products to create promotions like “buy one, get one for free”, “buy product X, get product Y for free”, “buy 10 of product X and get 1 of product X for a discounted price”, etc.</p>
                                                <p>
                                                    <img src="../resources/images/databaase_schema_guide/discount-promotion.png" />
                                                </p>
                                                <p><b>Structure</b>:</p>
                                                <ul>
                                                    <li value="1">The Discount is related to the SKU of one Abstract Product and a required Quantity.</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>