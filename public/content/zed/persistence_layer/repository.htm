<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Back-End|Zed|Persistence Layer">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Repository</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.topic-ratings-button
{
	-pie-background: transparent url('../../../Skins/Default/Stylesheets/Images/star-full.png') no-repeat center center;
}

.button.separator-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.edit-user-profile-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/edit-profile.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../../Resources/Scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search the Academy" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <script src="../../resources/prism.js">
                                </script>
                                <div class="search-container">
                                    <form class="search" action="#">
                                        <div class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                            <input class="search-field needs-pie" type="search" placeholder="Search" />
                                            <div class="search-filter-wrapper">
                                                <div class="search-filter">
                                                    <div class="search-filter-content">
                                                        <ul>
                                                            <li>All Files</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="search-submit-wrapper" dir="ltr">
                                                <div class="search-submit" title="Search">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="nocontent">
                                            <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="okAIHcwAmUCICz70xKBEhw">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="okAIHcwAmUCICz70xKBEhw:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: ;">
                                                    <div class="button-group-container-left">
                                                        <div class="button-group star-buttons loading feedback-topic-required">
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                            <div class="button star-button topic-ratings-empty-button" data-state1-class="topic-ratings-empty-button" data-state2-class="topic-ratings-button" title="Click a star to rate this topic" data-state1-title="Click a star to rate this topic" data-state2-title="Click a star to rate this topic">
                                                                <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="topic rating" />
                                                            </div>
                                                        </div>
                                                        <div class="button-separator feedback-topic-required">
                                                        </div>
                                                        <button class="button feedback-required login-button" id="normalLoginBtn" data-state1-class="login-button" data-state2-class="edit-user-profile-button" title="Login" data-state1-title="Login">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="login" />
                                                        </button>
                                                        <button class="button needs-pie print-button" title="Print">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                        </button>
                                                        <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                            <img src="../../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                        </button>
                                                    </div>
                                                </div>
                                                <h1>Repository</h1>
                                                <p>
    Since Kernel version 3.2 it's possible to use a Repository class in your persistence layer.
    The repository implements the <a href="https://martinfowler.com/eaaCatalog/repository.html" target="_blank">repository pattern</a>, which means you have clear separation between business and persistence layers. 
    Propel entities are not allowed outside the persistence layer. We are using transfer objects instead. This separation enables switching to different database systems or ORMs, you could even use NOSQL to store your data.

    <p>Each module must have the Repository class in <var>Persistence/ModuleNameRepository</var>. The repository must extend <var>\Spryker\Zed\Kernel\Persistence\AbstractRepository</var>
    which will provide a few helper methods when working with Propel entities.</p>

    See <a href="https://github.com/spryker/blog-example">Blog module</a> for reference - it was build using the Repository.

    For example, <var>BlogRepository</var> class:

    <pre><code clas="bash">
        use Spryker\Zed\Kernel\Persistence\AbstractRepository;

        /**
        * @method \Spryker\Zed\Blog\Persistence\BlogPersistenceFactory getFactory()
        */
        class BlogRepository extends AbstractRepository implements BlogRepositoryInterface
        {
         /**
           * @param string $firstName
           *
           * @return \Generated\Shared\Transfer\SpyBlogEntityTransfer
           */
          public function findBlogByName($firstName)
          {
              $customerQuery = $this-&gt;queryBlogByName($firstName)
                  -&gt;joinWithSpyBlogComment();

              return $this-&gt;buildQueryFromCriteria($customerQuery)-&gt;find()[0];
          }
        }
    </code></pre></p>
                                                <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />EntityTransfers</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>
    With the Publish and Synchronize feature we have added a new transfer generation for EntityTransfers. The EntityTransfers are direct representation of SQL tables,
    EntityTransfer has all properties and relations defined, also it holds FQCN to the Propel entity it is mapped to. This FQCN is used when mapping entity when data is persisted.
    Names of Entity Transfers start with <var>Spy</var>, followed by the table name, and then the <var>EntityTransfer</var> suffix. For example,  <var>SpyBlogEntityTransfer</var> would map to SpyBlog Propel entity.</p>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Abstract Repository Class</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>
    There are a few helper methods in <var>\Spryker\Zed\Kernel\Persistence\AbstractRepository</var>,

    <var>public function buildQueryFromCriteria(ModelCriteria $modelCriteria, CriteriaTransfer $criteriaTransfer = null);</var></p>
                                                        <p> <var>ModelCriteria</var> is a pre-built concrete propel query. The <var>CriteriaTransfer</var> is the basic query filtering, limit, offset, ordering.

    It will use custom formatter <var>\Spryker\Zed\Kernel\Persistence\Repository\TransferObjectFormatter</var> to transform database data to EntityTransfers.
    It will be then returned by repository itself, which saves you from manual mapping of data to transfer when data represented in transfers and entities is exactly the same.

    <var>public function populateCollectionWithRelation(array &amp;$collection, &amp;relation, Criteria &amp;criteria = null)</var>

    will populate <var>&amp;collection</var> with related data. For example, you need to return a list of blog posts with all the comments.
    Then you can make the main query like this:

    <pre><code class="language-PHP line-numbers">
    $collection = $this-&gt;buildQueryFromCriteria($blogQuery, $blogCriteriaFilterTransfer-&gt;getCriteria())
        -&gt;find();
    </code></pre>

    Then add another call:

    <pre><code class="language-PHP line-numbers">
        $comments = $this-&gt;populateCollectionWithRelation($collection, 'SpyBlogComment');
    </code></pre>

    The last statement will update blog collection with related comments. This will produce two queries: one for blog posts and another for comments.

    If, for example, you need to populate each comment with the related customer data, run:

    <pre><code class="language-PHP line-numbers">
       $this-&gt;populateCollectionWithRelation($comments, 'SpyBlogCustomer');
    </code></pre>

    This will populate comments with customer data, and the whole blog collection will have three level of relations:

    <pre><code class="language-PHP line-numbers">
      - SpyBlog[]
        - SpyBlogComment[]
          - SpyBlogCustomer[]
    </code></pre>

    This is a recommended approach to populate lists when limited usage is required, because Propel does not allow to limit usage when join "with*" is used.

</p>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Manual Mapping</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>
    When you have custom transfers which cannot be automatically mapped to entities, you have to create customer mapper classes. For example create <var>\Spryker\Zed\Blog\Persistence\Propel\Mapper\BlogMapper</var>
    which will know how to map from transfer to propel entity - create it in Factory.

   <pre><code class="language-PHP line-numbers">
        namespace Spryker\Zed\Blog\Persistence;

        use Spryker\Zed\Kernel\Persistence\AbstractPersistenceFactory;

        class BlogPersistenceFactory extends AbstractPersistenceFactory
        {
            /**
             * @return \Spryker\Zed\Blog\Persistence\Propel\Mapper\BlogMapper
             */
            public function createBlogMapper()
            {
                return new BlogMapper();
            }
        }
   </code></pre></p>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Conventions</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>
                                                            <h4>Querying</h4>
                                                            <ul>
                                                                <li value="1">When returning filtered collections by certain field use <var>find{Entity}CollectionBy{field}($field, CriteriaTransfer $criteriaTransfer)</var>. For example <var>findBlogCollectionByFirstName($firstName, CriteriaTransfer $criteriaTransfer = null)</var> </li>
                                                                <li value="2">When returning single item: <var>find{Entity}By{field}</var>. For example: <var>public function findBlogByName($firstName)</var> </li>
                                                                <li value="3">When counting records <var>public function count{Entity}By{Name}({name})</var>. For example: <var>public function countBlogByName($firstName)</var></li>
                                                            </ul>

  Those three queries share the same queries. For better reusability it's recommended to extract this logic to a protected method. For example:
  <pre><code class="language-PHP line-numbers">
        /**
          * @param string $name
          *
          * @return \Orm\Zed\Blog\Persistence\SpyBlogQuery
          */
         protected function queryBlogByName($name)
         {
             return $this-&gt;getFactory()
                 -&gt;createBlogQuery()
                 -&gt;filterByName($name);
         }
  </code></pre></p>
                                                    </div>
                                                </div>
                                                <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Repository Availability</a></span>
                                                    <div class="MCDropDownBody dropDownBody">
                                                        <p>
    The repository is available in all ZED layers where Spryker classes are resolvable. Get it in factories, controllers, facades or plugins using getRepository method. 
    If you want to use some of the methods from Repository, you have to create a Facade method in a corresponding module which would delegate to Repository.
   
</p>
                                                    </div>
                                                </div>
                                                <p>&#160;</p>
                                                <p><b>See also:</b>
                                                </p>
                                                <ul>
                                                    <li value="1"><a href="database_overview.htm">Database Overview</a>
                                                    </li>
                                                    <li value="2"><a href="database_schema_definition.htm">Defining Database Schema</a>
                                                    </li>
                                                    <li value="3"><a href="entity.htm">Learn about Entities and their usage</a>
                                                    </li>
                                                    <li value="4"><a href="entity.htm">Saving Entities with transactions</a>
                                                    </li>
                                                    <li value="5"><a href="entity-manager.htm">Learn about Entity Manager and how to use it</a><a href="#" class="selected"><![CDATA[			]]></a>
                                                    </li>
                                                    <li value="6"><a href="query_container.htm">Implementing and using a query container</a>
                                                    </li>
                                                    <li value="7"><a href="query_objects.htm">Creating query objects</a>
                                                    </li>
                                                </ul>
                                                <p>&#160;</p>
                                                <p><i>Last review date: Mar. 21st, 2018 </i>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>